<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Charon.Backend.Default.BackendArgs</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Backend.Default.BackendArgs.html#BackendArgs"><span class="hs-identifier">BackendArgs</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-7"></span><span class="hs-keyword">where</span><span>
</span><span id="line-8"></span><span>
</span><span id="line-9"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Backend.Data.html"><span class="hs-identifier">Charon.Backend.Data</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Backend.Data.html#Backend"><span class="hs-identifier">Backend</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-10"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Data.PathData.html"><span class="hs-identifier">Charon.Data.PathData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.PathData.html#PathData"><span class="hs-identifier">PathData</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-11"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Data.PathType.html"><span class="hs-identifier">Charon.Data.PathType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.PathType.html#PathTypeW"><span class="hs-identifier">PathTypeW</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html"><span class="hs-identifier">Charon.Data.Paths</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier">PathI</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathIndex"><span class="hs-identifier">PathIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryOriginalPath"><span class="hs-identifier">TrashEntryOriginalPath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier">TrashHome</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Data.Timestamp.html"><span class="hs-identifier">Charon.Data.Timestamp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Timestamp.html#Timestamp"><span class="hs-identifier">Timestamp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Prelude.html"><span class="hs-identifier">Charon.Prelude</span></a></span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-comment">-- We end up manually threading backendArgs through many of our Default/Trash</span><span>
</span><span id="line-17"></span><span class="hs-comment">-- functions. It is tempting to create a reader env for this, and then change</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- our signatures to HasBackendArgs. Unfortunately the pd type param gets in</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- our way.</span><span>
</span><span id="line-20"></span><span class="hs-comment">--</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- This is, our signatures end up looking like</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- foo :: forall m env pd. (HasBackendArgs env m pd, MonadReader env m)</span><span>
</span><span id="line-24"></span><span class="hs-comment">--</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- but GHC cannot infer that we are passing the same type pd throughout the</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- program, so we have to add manual annotations e.g.</span><span>
</span><span id="line-27"></span><span class="hs-comment">--</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- foo @_ @_ @pd</span><span>
</span><span id="line-29"></span><span class="hs-comment">--</span><span>
</span><span id="line-30"></span><span class="hs-comment">-- Thus we are back to manual threading, defeating the purpose of using</span><span>
</span><span id="line-31"></span><span class="hs-comment">-- Reader.</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">-- | Additional params used by the default backend that are parameterized on</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- the backend-specific PathData, pd.</span><span>
</span><span id="line-35"></span><span class="hs-keyword">data</span><span> </span><span id="BackendArgs"><span class="annot"><a href="Charon.Backend.Default.BackendArgs.html#BackendArgs"><span class="hs-identifier hs-var">BackendArgs</span></a></span></span><span> </span><span id="local-6989586621679630356"><span class="annot"><a href="#local-6989586621679630356"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679630357"><span class="annot"><a href="#local-6989586621679630357"><span class="hs-identifier hs-type">pd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="MkBackendArgs"><span class="annot"><a href="Charon.Backend.Default.BackendArgs.html#MkBackendArgs"><span class="hs-identifier hs-var">MkBackendArgs</span></a></span></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="hs-comment">-- | The backend type.</span></span><span>
</span><span id="line-37"></span><span>    </span><span id="%24sel%3Abackend%3AMkBackendArgs"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) pd. BackendArgs m pd -&gt; Backend
</span><a href="Charon.Backend.Default.BackendArgs.html#%24sel%3Abackend%3AMkBackendArgs"><span class="hs-identifier hs-var hs-var">backend</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Charon.Backend.Data.html#Backend"><span class="hs-identifier hs-type">Backend</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Function for creating the custom path data pd.</span></span><span>
</span><span id="line-39"></span><span>    </span><span id="%24sel%3AmakePathData%3AMkBackendArgs"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) pd.
BackendArgs m pd
-&gt; Timestamp
-&gt; PathI 'TrashHome
-&gt; PathI 'TrashEntryOriginalPath
-&gt; m (pd, PathTypeW)
</span><a href="Charon.Backend.Default.BackendArgs.html#%24sel%3AmakePathData%3AMkBackendArgs"><span class="hs-identifier hs-var hs-var">makePathData</span></a></span></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-40"></span><span>      </span><span class="annot"><a href="Charon.Data.Timestamp.html#Timestamp"><span class="hs-identifier hs-type">Timestamp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-41"></span><span>      </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-42"></span><span>      </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryOriginalPath"><span class="hs-identifier hs-type">TrashEntryOriginalPath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-43"></span><span>      </span><span class="annot"><a href="#local-6989586621679630356"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679630357"><span class="hs-identifier hs-type">pd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Data.PathType.html#PathTypeW"><span class="hs-identifier hs-type">PathTypeW</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Transformation from custom pd to common PathData.</span></span><span>
</span><span id="line-45"></span><span>    </span><span id="%24sel%3AtoCorePathData%3AMkBackendArgs"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) pd.
BackendArgs m pd -&gt; PathI 'TrashHome -&gt; pd -&gt; m PathData
</span><a href="Charon.Backend.Default.BackendArgs.html#%24sel%3AtoCorePathData%3AMkBackendArgs"><span class="hs-identifier hs-var hs-var">toCorePathData</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679630357"><span class="hs-identifier hs-type">pd</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679630356"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Charon.Data.PathData.html#PathData"><span class="hs-identifier hs-type">PathData</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Transformation from common PathData to custom pd.</span></span><span>
</span><span id="line-47"></span><span>    </span><span id="%24sel%3AfromCorePathData%3AMkBackendArgs"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) pd. BackendArgs m pd -&gt; PathData -&gt; pd
</span><a href="Charon.Backend.Default.BackendArgs.html#%24sel%3AfromCorePathData%3AMkBackendArgs"><span class="hs-identifier hs-var hs-var">fromCorePathData</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Charon.Data.PathData.html#PathData"><span class="hs-identifier hs-type">PathData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679630357"><span class="hs-identifier hs-type">pd</span></a></span><span>
</span><span id="line-48"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-49"></span><span>
</span><span id="line-50"></span><span id="local-6989586621679630356"><span id="local-6989586621679630357"><span id="local-6989586621679630407"><span id="local-6989586621679630408"><span id="local-6989586621679630409"><span id="local-6989586621679630410"><span id="local-6989586621679630411"><span id="local-6989586621679630412"><span id="local-6989586621679630413"><span id="local-6989586621679630414"><span id="local-6989586621679630415"><span id="local-6989586621679630416"><span id="local-6989586621679630417"><span id="local-6989586621679630418"><span id="local-6989586621679630442"><span id="local-6989586621679630447"><span id="local-6989586621679630452"><span id="local-6989586621679630457"><span class="hs-identifier">makeFieldLabelsNoPrefix</span><span> </span><span class="hs-special">''</span><span class="hs-identifier">BackendArgs</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-51"></span></pre></body></html>