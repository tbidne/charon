<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="annot"><span class="hs-comment">-- | This modules provides an executable for running charon.</span></span><span>
</span><span id="line-5"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Charon.Runner</span><span>
</span><span id="line-6"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Main functions</span></span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Charon.Runner.html#runCharon"><span class="hs-identifier">runCharon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Charon.Runner.html#runCmd"><span class="hs-identifier">runCmd</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Helpers</span></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Charon.Runner.html#getConfiguration"><span class="hs-identifier">getConfiguration</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span class="hs-keyword">where</span><span>
</span><span id="line-14"></span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.html"><span class="hs-identifier">Charon</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Backend.Data.html"><span class="hs-identifier">Charon.Backend.Data</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Backend.Data.html#Backend"><span class="hs-identifier">Backend</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Backend.Data.html#BackendCbor"><span class="hs-identifier">BackendCbor</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Data.Index.html"><span class="hs-identifier">Charon.Data.Index</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Index</span></span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html"><span class="hs-identifier">Charon.Data.Paths</span></a></span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier">PathI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#MkPathI"><span class="hs-identifier">MkPathI</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>    </span><span class="annot"><a href="Charon.Data.Paths.html#PathIndex"><span class="hs-identifier">PathIndex</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier">TrashHome</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Env.html"><span class="hs-identifier">Charon.Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Env.html#HasBackend"><span class="hs-identifier">HasBackend</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Env.html#HasTrashHome"><span class="hs-identifier">HasTrashHome</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Env.html"><span class="hs-identifier">Charon.Env</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Env</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Prelude.html"><span class="hs-identifier">Charon.Prelude</span></a></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Runner.Args.html"><span class="hs-identifier">Charon.Runner.Args</span></a></span><span>
</span><span id="line-26"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Runner.Args.html#TomlConfigPath"><span class="hs-identifier">TomlConfigPath</span></a></span><span>
</span><span id="line-27"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Runner.Args.html#TomlDefault"><span class="hs-identifier">TomlDefault</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="Charon.Runner.Args.html#TomlNone"><span class="hs-identifier">TomlNone</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="Charon.Runner.Args.html#TomlPath"><span class="hs-identifier">TomlPath</span></a></span><span>
</span><span id="line-30"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>    </span><span class="annot"><a href="Charon.Runner.Args.html#getArgs"><span class="hs-identifier">getArgs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Runner.CharonT.html"><span class="hs-identifier">Charon.Runner.CharonT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Runner.CharonT.html#runCharonT"><span class="hs-identifier">runCharonT</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Runner.Command.html"><span class="hs-identifier">Charon.Runner.Command</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Runner.Command.html#Command"><span class="hs-identifier">Command</span></a></span><span>
</span><span id="line-36"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Runner.Command.html#Convert"><span class="hs-identifier">Convert</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>        </span><span class="annot"><a href="Charon.Runner.Command.html#Delete"><span class="hs-identifier">Delete</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>        </span><span class="annot"><a href="Charon.Runner.Command.html#Empty"><span class="hs-identifier">Empty</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>        </span><span class="annot"><a href="Charon.Runner.Command.html#List"><span class="hs-identifier">List</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>        </span><span class="annot"><a href="Charon.Runner.Command.html#Merge"><span class="hs-identifier">Merge</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>        </span><span class="annot"><a href="Charon.Runner.Command.html#Metadata"><span class="hs-identifier">Metadata</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>        </span><span class="annot"><a href="Charon.Runner.Command.html#PermDelete"><span class="hs-identifier">PermDelete</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>        </span><span class="annot"><a href="Charon.Runner.Command.html#Restore"><span class="hs-identifier">Restore</span></a></span><span>
</span><span id="line-44"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-45"></span><span>    </span><span class="annot"><a href="Charon.Runner.Command.html#CommandP2"><span class="hs-identifier">CommandP2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-46"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Runner.Command.List.html"><span class="hs-identifier">Charon.Runner.Command.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Runner.Command.List.html#ListCmdP2"><span class="hs-identifier">ListCmdP2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Runner.Env.html"><span class="hs-identifier">Charon.Runner.Env</span></a></span><span>
</span><span id="line-49"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Runner.Env.html#Env"><span class="hs-identifier">Env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Runner.Env.html#MkEnv"><span class="hs-identifier">MkEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Runner.Env.html#%24sel%3Abackend%3AMkEnv"><span class="hs-identifier">backend</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Runner.Env.html#%24sel%3AtrashHome%3AMkEnv"><span class="hs-identifier">trashHome</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><a href="Charon.Runner.Env.html#LogEnv"><span class="hs-identifier">LogEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Runner.Env.html#MkLogEnv"><span class="hs-identifier">MkLogEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><a href="Charon.Runner.Env.html#LogFile"><span class="hs-identifier">LogFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Runner.Env.html#MkLogFile"><span class="hs-identifier">MkLogFile</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><a href="Charon.Runner.Env.html#%24sel%3Ahandle%3AMkLogFile"><span class="hs-identifier">handle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><a href="Charon.Runner.Env.html#%24sel%3AlogEnv%3AMkEnv"><span class="hs-identifier">logEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-54"></span><span>    </span><span class="annot"><a href="Charon.Runner.Env.html#%24sel%3AlogFile%3AMkLogEnv"><span class="hs-identifier">logFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><a href="Charon.Runner.Env.html#%24sel%3AlogLevel%3AMkLogFile"><span class="hs-identifier">logLevel</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><a href="Charon.Runner.Env.html#%24sel%3AlogNamespace%3AMkLogEnv"><span class="hs-identifier">logNamespace</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Runner.FileSizeMode.html"><span class="hs-identifier">Charon.Runner.FileSizeMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Runner.FileSizeMode.html#FileSizeMode"><span class="hs-identifier">FileSizeMode</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Runner.FileSizeMode.html"><span class="hs-identifier">Charon.Runner.FileSizeMode</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FileSizeMode</span></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Runner.Toml.html"><span class="hs-identifier">Charon.Runner.Toml</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Runner.Toml.html#TomlConfig"><span class="hs-identifier">TomlConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Runner.Toml.html#defaultTomlConfig"><span class="hs-identifier">defaultTomlConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Runner.Toml.html#mergeConfigs"><span class="hs-identifier">mergeConfigs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Utils.html"><span class="hs-identifier">Charon.Utils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">U</span></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/si-bytes-0.1-97cb24a33de91ba49ee0c56be2863dcf522540262bce46ec251c99d0bda0642a/share/doc/html/src/Data.Bytes.html"><span class="hs-identifier">Data.Bytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/si-bytes-0.1-97cb24a33de91ba49ee0c56be2863dcf522540262bce46ec251c99d0bda0642a/share/doc/html/src/Data.Bytes.Formatting.Base.html#FloatingFormatter"><span class="hs-identifier">FloatingFormatter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/si-bytes-0.1-97cb24a33de91ba49ee0c56be2863dcf522540262bce46ec251c99d0bda0642a/share/doc/html/src/Data.Bytes.Formatting.Base.html#MkFloatingFormatter"><span class="hs-identifier">MkFloatingFormatter</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/si-bytes-0.1-97cb24a33de91ba49ee0c56be2863dcf522540262bce46ec251c99d0bda0642a/share/doc/html/src/Data.Bytes.html"><span class="hs-identifier">Data.Bytes</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Bytes</span></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Text</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">T</span></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.HandleWriter.html"><span class="hs-identifier">Effects.FileSystem.HandleWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.HandleWriter.html#withBinaryFile"><span class="hs-identifier">withBinaryFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html"><span class="hs-identifier">Effects.FileSystem.PathReader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#getXdgData"><span class="hs-identifier">getXdgData</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#getXdgState"><span class="hs-identifier">getXdgState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathWriter.html"><span class="hs-identifier">Effects.FileSystem.PathWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathWriter.html#MonadPathWriter"><span class="hs-identifier">MonadPathWriter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathWriter.html#removeFile"><span class="hs-identifier">removeFile</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/gfwzh9i8rj34931p88bivbfkk2k4cn2d-toml-reader-0.2.1.0-doc/share/doc/toml-reader-0.2.1.0/html/src/TOML.html"><span class="hs-identifier">TOML</span></a></span><span> </span><span class="hs-keyword">qualified</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span class="hs-comment">-- | Entry point for running Charon. Does everything: reads CLI args,</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- optional Toml config, and creates the environment before running</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- Charon.</span><span>
</span><span id="line-73"></span><span id="local-6989586621679644127"><span class="annot"><a href="Charon.Runner.html#runCharon"><span class="hs-identifier hs-type">runCharon</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-async-0.1-ef1cb19e8fbf2dc116242b18cd3b9e7b5c92122705eb34b11f5acc170f2280d5/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.FileReader.html#MonadFileReader"><span class="hs-identifier hs-type">MonadFileReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.FileWriter.html#MonadFileWriter"><span class="hs-identifier hs-type">MonadFileWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.HandleWriter.html#MonadHandleWriter"><span class="hs-identifier hs-type">MonadHandleWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-ioref-0.1-3cac930c17e584be09a56666d026afdff4ce6517720bfb8a0d4dbe602e96e94f/share/doc/html/src/Effects.IORef.html#MonadIORef"><span class="hs-identifier hs-type">MonadIORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-optparse-0.1-4e037383561ff7fea88981d0257a2f768f1974347ba7739709ad65ce1d2914e0/share/doc/html/src/Effects.Optparse.html#MonadOptparse"><span class="hs-identifier hs-type">MonadOptparse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-83"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathWriter.html#MonadPathWriter"><span class="hs-identifier hs-type">MonadPathWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-84"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-unix-compat-0.1-9d56e686bd87cf957ed28aa8665c62fc4afee54f74eb31f0de31da53bf4c3734/share/doc/html/src/Effects.System.PosixCompat.html#MonadPosixCompat"><span class="hs-identifier hs-type">MonadPosixCompat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#MonadTerminal"><span class="hs-identifier hs-type">MonadTerminal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-time-0.1-823c98a264bd4dbc7f6570016b9dec1546976c4fe5abece18695d52e935fc334/share/doc/html/src/Effects.Time.html#MonadTime"><span class="hs-identifier hs-type">MonadTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="#local-6989586621679644127"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-89"></span><span id="runCharon"><span class="annot"><span class="annottext">runCharon :: forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadFileReader m, MonadFileWriter m,
 MonadHandleWriter m, MonadIORef m, MonadMask m, MonadOptparse m,
 MonadPathReader m, MonadPathWriter m, MonadPosixCompat m,
 MonadTerminal m, MonadTime m) =&gt;
m ()
</span><a href="Charon.Runner.html#runCharon"><span class="hs-identifier hs-var hs-var">runCharon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679644505"><span class="annot"><span class="annottext">TomlConfig
</span><a href="#local-6989586621679644505"><span class="hs-identifier hs-var">config</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679644506"><span class="annot"><span class="annottext">CommandP2
</span><a href="#local-6989586621679644506"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (TomlConfig, CommandP2)
forall (m :: * -&gt; *).
(HasCallStack, MonadFileReader m, MonadOptparse m,
 MonadPathReader m, MonadThrow m) =&gt;
m (TomlConfig, CommandP2)
</span><a href="Charon.Runner.html#getConfiguration"><span class="hs-identifier hs-var">getConfiguration</span></a></span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><span class="annottext">TomlConfig -&gt; (Env m -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) a.
(HasCallStack, MonadFileWriter m, MonadHandleWriter m,
 MonadPathReader m, MonadPathWriter m, MonadTerminal m) =&gt;
TomlConfig -&gt; (Env m -&gt; m a) -&gt; m a
</span><a href="Charon.Runner.html#withEnv"><span class="hs-identifier hs-var">withEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TomlConfig
</span><a href="#local-6989586621679644505"><span class="hs-identifier hs-var">config</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CharonT (Env m) m () -&gt; Env m -&gt; m ()
forall env (m :: * -&gt; *) a. CharonT env m a -&gt; env -&gt; m a
</span><a href="Charon.Runner.CharonT.html#runCharonT"><span class="hs-identifier hs-var">runCharonT</span></a></span><span> </span><span class="annot"><span class="annottext">(CharonT (Env m) m () -&gt; Env m -&gt; m ())
-&gt; CharonT (Env m) m () -&gt; Env m -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">CommandP2 -&gt; CharonT (Env m) m ()
forall (m :: * -&gt; *) env.
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadLoggerNS m, MonadFileReader m, MonadFileWriter m,
 MonadHandleWriter m, MonadIORef m, MonadMask m, MonadPathReader m,
 MonadPathWriter m, MonadPosixCompat m, MonadReader env m,
 MonadTerminal m, MonadTime m) =&gt;
CommandP2 -&gt; m ()
</span><a href="Charon.Runner.html#runCmd"><span class="hs-identifier hs-var">runCmd</span></a></span><span> </span><span class="annot"><span class="annottext">CommandP2
</span><a href="#local-6989586621679644506"><span class="hs-identifier hs-var">cmd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">-- | Runs Charon in the given environment. This is useful in conjunction with</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- 'getConfiguration' as an alternative 'runCharon', when we want to use a</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- custom env.</span><span>
</span><span id="line-96"></span><span class="annot"><a href="Charon.Runner.html#runCmd"><span class="hs-identifier hs-type">runCmd</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679644193"><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679644192"><span class="annot"><a href="#local-6989586621679644192"><span class="hs-identifier hs-type">env</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Env.html#HasBackend"><span class="hs-identifier hs-type">HasBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644192"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="Charon.Env.html#HasTrashHome"><span class="hs-identifier hs-type">HasTrashHome</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644192"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-async-0.1-ef1cb19e8fbf2dc116242b18cd3b9e7b5c92122705eb34b11f5acc170f2280d5/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#MonadLoggerNS"><span class="hs-identifier hs-type">MonadLoggerNS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.FileReader.html#MonadFileReader"><span class="hs-identifier hs-type">MonadFileReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.FileWriter.html#MonadFileWriter"><span class="hs-identifier hs-type">MonadFileWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.HandleWriter.html#MonadHandleWriter"><span class="hs-identifier hs-type">MonadHandleWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-ioref-0.1-3cac930c17e584be09a56666d026afdff4ce6517720bfb8a0d4dbe602e96e94f/share/doc/html/src/Effects.IORef.html#MonadIORef"><span class="hs-identifier hs-type">MonadIORef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadMask</span></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathWriter.html#MonadPathWriter"><span class="hs-identifier hs-type">MonadPathWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-unix-compat-0.1-9d56e686bd87cf957ed28aa8665c62fc4afee54f74eb31f0de31da53bf4c3734/share/doc/html/src/Effects.System.PosixCompat.html#MonadPosixCompat"><span class="hs-identifier hs-type">MonadPosixCompat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679644192"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#MonadTerminal"><span class="hs-identifier hs-type">MonadTerminal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-time-0.1-823c98a264bd4dbc7f6570016b9dec1546976c4fe5abece18695d52e935fc334/share/doc/html/src/Effects.Time.html#MonadTime"><span class="hs-identifier hs-type">MonadTime</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><a href="Charon.Runner.Command.html#CommandP2"><span class="hs-identifier hs-type">CommandP2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span id="runCmd"><span class="annot"><span class="annottext">runCmd :: forall (m :: * -&gt; *) env.
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadLoggerNS m, MonadFileReader m, MonadFileWriter m,
 MonadHandleWriter m, MonadIORef m, MonadMask m, MonadPathReader m,
 MonadPathWriter m, MonadPosixCompat m, MonadReader env m,
 MonadTerminal m, MonadTime m) =&gt;
CommandP2 -&gt; m ()
</span><a href="Charon.Runner.html#runCmd"><span class="hs-identifier hs-var hs-var">runCmd</span></a></span></span><span> </span><span id="local-6989586621679644540"><span class="annot"><span class="annottext">CommandP2
</span><a href="#local-6989586621679644540"><span class="hs-identifier hs-var">cmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-comment">-- NOTE: This adds a callstack to any thrown exceptions e.g. exitFailure.</span><span>
</span><span id="line-119"></span><span>  </span><span class="hs-comment">-- This is what we want, as it similar to what we will get once GHC</span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-comment">-- natively supports exceptions with callstacks.</span><span>
</span><span id="line-121"></span><span>  </span><span class="annot"><span class="annottext">CommandP2 -&gt; m ()
</span><a href="#local-6989586621679644541"><span class="hs-identifier hs-var">runCmd'</span></a></span><span> </span><span class="annot"><span class="annottext">CommandP2
</span><a href="#local-6989586621679644540"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">m () -&gt; (SomeException -&gt; m ()) -&gt; m ()
forall (m :: * -&gt; *) e a.
(Exception e, HasCallStack, MonadCatch m) =&gt;
m a -&gt; (e -&gt; m a) -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-exceptions-0.1-cbc6c6992b43b60e49e859c21827717f4c8f4d9ff6ce5ae6d908553d0e8694a2/share/doc/html/src/Effects.Exception.html#catchCS"><span class="hs-operator hs-var">`catchCS`</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; m ()
forall a. HasCallStack =&gt; SomeException -&gt; m a
</span><a href="#local-6989586621679644543"><span class="hs-identifier hs-var">logEx</span></a></span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-123"></span><span>    </span><span id="local-6989586621679644541"><span class="annot"><span class="annottext">runCmd' :: CommandP2 -&gt; m ()
</span><a href="#local-6989586621679644541"><span class="hs-identifier hs-var hs-var">runCmd'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-124"></span><span>      </span><span class="annot"><a href="Charon.Runner.Command.html#Delete"><span class="hs-identifier hs-type">Delete</span></a></span><span> </span><span id="local-6989586621679644707"><span class="annot"><span class="annottext">UniqueSeqNE (PathI 'TrashEntryOriginalPath)
</span><a href="#local-6989586621679644707"><span class="hs-identifier hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqueSeqNE (PathI 'TrashEntryOriginalPath) -&gt; m ()
forall env (m :: * -&gt; *).
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadCatch m, MonadFileReader m, MonadFileWriter m, MonadIORef m,
 MonadLoggerNS m, MonadPathReader m, MonadPathWriter m,
 MonadPosixCompat m, MonadReader env m, MonadTerminal m,
 MonadTime m) =&gt;
UniqueSeqNE (PathI 'TrashEntryOriginalPath) -&gt; m ()
</span><a href="Charon.html#delete"><span class="hs-identifier hs-var">Charon.delete</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueSeqNE (PathI 'TrashEntryOriginalPath)
</span><a href="#local-6989586621679644707"><span class="hs-identifier hs-var">paths</span></a></span><span>
</span><span id="line-125"></span><span>      </span><span class="annot"><a href="Charon.Runner.Command.html#PermDelete"><span class="hs-identifier hs-type">PermDelete</span></a></span><span> </span><span id="local-6989586621679644709"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679644709"><span class="hs-identifier hs-var">force</span></a></span></span><span> </span><span id="local-6989586621679644710"><span class="annot"><span class="annottext">UniqueSeqNE (PathI 'TrashEntryFileName)
</span><a href="#local-6989586621679644710"><span class="hs-identifier hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; UniqueSeqNE (PathI 'TrashEntryFileName) -&gt; m ()
forall env (m :: * -&gt; *).
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadCatch m, MonadFileReader m, MonadFileWriter m,
 MonadHandleWriter m, MonadIORef m, MonadPathReader m,
 MonadPathWriter m, MonadPosixCompat m, MonadLoggerNS m,
 MonadReader env m, MonadTerminal m, MonadTime m) =&gt;
Bool -&gt; UniqueSeqNE (PathI 'TrashEntryFileName) -&gt; m ()
</span><a href="Charon.html#permDelete"><span class="hs-identifier hs-var">Charon.permDelete</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679644709"><span class="hs-identifier hs-var">force</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueSeqNE (PathI 'TrashEntryFileName)
</span><a href="#local-6989586621679644710"><span class="hs-identifier hs-var">paths</span></a></span><span>
</span><span id="line-126"></span><span>      </span><span class="annot"><a href="Charon.Runner.Command.html#Empty"><span class="hs-identifier hs-type">Empty</span></a></span><span> </span><span id="local-6989586621679644712"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679644712"><span class="hs-identifier hs-var">force</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; m ()
forall (m :: * -&gt; *) env.
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadCatch m, MonadFileReader m, MonadHandleWriter m,
 MonadLoggerNS m, MonadPathReader m, MonadPathWriter m,
 MonadPosixCompat m, MonadReader env m, MonadTerminal m) =&gt;
Bool -&gt; m ()
</span><a href="Charon.html#emptyTrash"><span class="hs-identifier hs-var">Charon.emptyTrash</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679644712"><span class="hs-identifier hs-var">force</span></a></span><span>
</span><span id="line-127"></span><span>      </span><span class="annot"><a href="Charon.Runner.Command.html#Restore"><span class="hs-identifier hs-type">Restore</span></a></span><span> </span><span id="local-6989586621679644714"><span class="annot"><span class="annottext">UniqueSeqNE (PathI 'TrashEntryFileName)
</span><a href="#local-6989586621679644714"><span class="hs-identifier hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqueSeqNE (PathI 'TrashEntryFileName) -&gt; m ()
forall env (m :: * -&gt; *).
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadCatch m, MonadFileReader m, MonadFileWriter m, MonadIORef m,
 MonadLoggerNS m, MonadPathReader m, MonadPathWriter m,
 MonadPosixCompat m, MonadReader env m, MonadTerminal m,
 MonadTime m) =&gt;
UniqueSeqNE (PathI 'TrashEntryFileName) -&gt; m ()
</span><a href="Charon.html#restore"><span class="hs-identifier hs-var">Charon.restore</span></a></span><span> </span><span class="annot"><span class="annottext">UniqueSeqNE (PathI 'TrashEntryFileName)
</span><a href="#local-6989586621679644714"><span class="hs-identifier hs-var">paths</span></a></span><span>
</span><span id="line-128"></span><span>      </span><span class="annot"><a href="Charon.Runner.Command.html#List"><span class="hs-identifier hs-type">List</span></a></span><span> </span><span id="local-6989586621679644716"><span class="annot"><span class="annottext">ListCmd 'Phase2
</span><a href="#local-6989586621679644716"><span class="hs-identifier hs-var">listCmd</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ListCmd 'Phase2 -&gt; m ()
forall env (m :: * -&gt; *).
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadCatch m, MonadFileReader m, MonadLoggerNS m,
 MonadPathReader m, MonadPosixCompat m, MonadReader env m,
 MonadTerminal m) =&gt;
ListCmd 'Phase2 -&gt; m ()
</span><a href="Charon.Runner.html#printIndex"><span class="hs-identifier hs-var">printIndex</span></a></span><span> </span><span class="annot"><span class="annottext">ListCmd 'Phase2
</span><a href="#local-6989586621679644716"><span class="hs-identifier hs-var">listCmd</span></a></span><span>
</span><span id="line-129"></span><span>      </span><span class="annot"><span class="annottext">CommandP2
</span><a href="Charon.Runner.Command.html#Metadata"><span class="hs-identifier hs-var">Metadata</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m ()
forall env (m :: * -&gt; *).
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadCatch m, MonadFileReader m, MonadLoggerNS m,
 MonadPathReader m, MonadPosixCompat m, MonadReader env m,
 MonadTerminal m) =&gt;
m ()
</span><a href="Charon.Runner.html#printMetadata"><span class="hs-identifier hs-var">printMetadata</span></a></span><span>
</span><span id="line-130"></span><span>      </span><span class="annot"><a href="Charon.Runner.Command.html#Convert"><span class="hs-identifier hs-type">Convert</span></a></span><span> </span><span id="local-6989586621679644719"><span class="annot"><span class="annottext">Backend
</span><a href="#local-6989586621679644719"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; m ()
forall env (m :: * -&gt; *).
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadFileReader m, MonadFileWriter m, MonadIORef m,
 MonadLoggerNS m, MonadMask m, MonadPathReader m, MonadPathWriter m,
 MonadPosixCompat m, MonadReader env m, MonadTerminal m,
 MonadTime m) =&gt;
Backend -&gt; m ()
</span><a href="Charon.html#convert"><span class="hs-identifier hs-var">Charon.convert</span></a></span><span> </span><span class="annot"><span class="annottext">Backend
</span><a href="#local-6989586621679644719"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-131"></span><span>      </span><span class="annot"><a href="Charon.Runner.Command.html#Merge"><span class="hs-identifier hs-type">Merge</span></a></span><span> </span><span id="local-6989586621679644721"><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679644721"><span class="hs-identifier hs-var">dest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome -&gt; m ()
forall env (m :: * -&gt; *).
(HasBackend env, HasCallStack, HasTrashHome env, MonadFileReader m,
 MonadFileWriter m, MonadIORef m, MonadLoggerNS m, MonadMask m,
 MonadPathReader m, MonadPathWriter m, MonadReader env m,
 MonadTerminal m, MonadTime m) =&gt;
PathI 'TrashHome -&gt; m ()
</span><a href="Charon.html#merge"><span class="hs-identifier hs-var">Charon.merge</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679644721"><span class="hs-identifier hs-var">dest</span></a></span><span>
</span><span id="line-132"></span><span>
</span><span id="line-133"></span><span>    </span><span id="local-6989586621679644205"><span class="annot"><a href="#local-6989586621679644543"><span class="hs-identifier hs-type">logEx</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">SomeException</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679644193"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644205"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679644543"><span class="annot"><span class="annottext">logEx :: forall a. HasCallStack =&gt; SomeException -&gt; m a
</span><a href="#local-6989586621679644543"><span class="hs-identifier hs-var hs-var">logEx</span></a></span></span><span> </span><span id="local-6989586621679644733"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679644733"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>      </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6db4xyc3nivqvp6qrbbjc6j03f9zblbr-monad-logger-0.3.40-doc/share/doc/monad-logger-0.3.40/html/src/Control.Monad.Logger.html#logError"><span class="hs-identifier hs-type">logError</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Text
</span><span class="hs-identifier hs-var">T.pack</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Text) -&gt; String -&gt; Text
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; String
forall e. Exception e =&gt; e -&gt; String
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-exceptions-0.1-cbc6c6992b43b60e49e859c21827717f4c8f4d9ff6ce5ae6d908553d0e8694a2/share/doc/html/src/Effects.Exception.html#displayNoCS"><span class="hs-identifier hs-var">displayNoCS</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679644733"><span class="hs-identifier hs-var">ex</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-136"></span><span>      </span><span class="annot"><span class="annottext">SomeException -&gt; m a
forall (m :: * -&gt; *) e a.
(Exception e, HasCallStack, MonadThrow m) =&gt;
e -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-exceptions-0.1-cbc6c6992b43b60e49e859c21827717f4c8f4d9ff6ce5ae6d908553d0e8694a2/share/doc/html/src/Effects.Exception.html#throwCS"><span class="hs-identifier hs-var">throwCS</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621679644733"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span id="local-6989586621679644184"><span id="local-6989586621679644185"><span class="annot"><a href="Charon.Runner.html#withEnv"><span class="hs-identifier hs-type">withEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.FileWriter.html#MonadFileWriter"><span class="hs-identifier hs-type">MonadFileWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644184"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-141"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.HandleWriter.html#MonadHandleWriter"><span class="hs-identifier hs-type">MonadHandleWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644184"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644184"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathWriter.html#MonadPathWriter"><span class="hs-identifier hs-type">MonadPathWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644184"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#MonadTerminal"><span class="hs-identifier hs-type">MonadTerminal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644184"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><a href="Charon.Runner.Toml.html#TomlConfig"><span class="hs-identifier hs-type">TomlConfig</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Runner.Env.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644184"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679644184"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644185"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="#local-6989586621679644184"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644185"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-149"></span><span id="withEnv"><span class="annot"><span class="annottext">withEnv :: forall (m :: * -&gt; *) a.
(HasCallStack, MonadFileWriter m, MonadHandleWriter m,
 MonadPathReader m, MonadPathWriter m, MonadTerminal m) =&gt;
TomlConfig -&gt; (Env m -&gt; m a) -&gt; m a
</span><a href="Charon.Runner.html#withEnv"><span class="hs-identifier hs-var hs-var">withEnv</span></a></span></span><span> </span><span id="local-6989586621679644802"><span class="annot"><span class="annottext">TomlConfig
</span><a href="#local-6989586621679644802"><span class="hs-identifier hs-var">mergedConfig</span></a></span></span><span> </span><span id="local-6989586621679644803"><span class="annot"><span class="annottext">Env m -&gt; m a
</span><a href="#local-6989586621679644803"><span class="hs-identifier hs-var">onEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621679644804"><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679644804"><span class="hs-identifier hs-var">trashHome</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (PathI 'TrashHome) -&gt; m (PathI 'TrashHome)
forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m) =&gt;
Maybe (PathI 'TrashHome) -&gt; m (PathI 'TrashHome)
</span><a href="Charon.Runner.html#trashOrDefault"><span class="hs-identifier hs-var">trashOrDefault</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (PathI 'TrashHome) -&gt; m (PathI 'TrashHome))
-&gt; Maybe (PathI 'TrashHome) -&gt; m (PathI 'TrashHome)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">TomlConfig
</span><a href="#local-6989586621679644802"><span class="hs-identifier hs-var">mergedConfig</span></a></span><span> </span><span class="annot"><span class="annottext">TomlConfig
-&gt; Optic' A_Lens NoIx TomlConfig (Maybe (PathI 'TrashHome))
-&gt; Maybe (PathI 'TrashHome)
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/4wakibz21ahaapk6h38p2l10j9a6z58i-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TomlConfig (Maybe (PathI 'TrashHome))
</span><span class="">#trashHome</span></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span>  </span><span class="annot"><span class="annottext">Maybe FileSizeMode -&gt; (Handle -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a.
(HasCallStack, MonadFileWriter m, MonadHandleWriter m,
 MonadPathReader m, MonadPathWriter m, MonadTerminal m) =&gt;
Maybe FileSizeMode -&gt; (Handle -&gt; m a) -&gt; m a
</span><a href="Charon.Runner.html#withLogHandle"><span class="hs-identifier hs-var">withLogHandle</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TomlConfig
</span><a href="#local-6989586621679644802"><span class="hs-identifier hs-var">mergedConfig</span></a></span><span> </span><span class="annot"><span class="annottext">TomlConfig
-&gt; Optic' A_Lens NoIx TomlConfig (Maybe FileSizeMode)
-&gt; Maybe FileSizeMode
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/4wakibz21ahaapk6h38p2l10j9a6z58i-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TomlConfig (Maybe FileSizeMode)
</span><span class="">#logSizeMode</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((Handle -&gt; m a) -&gt; m a) -&gt; (Handle -&gt; m a) -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679644808"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621679644808"><span class="hs-identifier hs-var">handle</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679644809"><span class="annot"><span class="annottext">logFile :: Maybe (LogFile m)
</span><a href="#local-6989586621679644809"><span class="hs-identifier hs-var hs-var">logFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-154"></span><span>          </span><span class="annot"><span class="annottext">Maybe (Maybe LogLevel) -&gt; Maybe LogLevel
forall (m :: * -&gt; *) a. Monad m =&gt; m (m a) -&gt; m a
</span><span class="hs-identifier hs-var">join</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TomlConfig
</span><a href="#local-6989586621679644802"><span class="hs-identifier hs-var">mergedConfig</span></a></span><span> </span><span class="annot"><span class="annottext">TomlConfig
-&gt; Optic' A_Lens NoIx TomlConfig (Maybe (Maybe LogLevel))
-&gt; Maybe (Maybe LogLevel)
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/4wakibz21ahaapk6h38p2l10j9a6z58i-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TomlConfig (Maybe (Maybe LogLevel))
</span><span class="">#logLevel</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe LogLevel -&gt; (LogLevel -&gt; LogFile m) -&gt; Maybe (LogFile m)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><span class="hs-operator hs-var">&lt;&amp;&gt;</span></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621679644811"><span class="annot"><span class="annottext">LogLevel
</span><a href="#local-6989586621679644811"><span class="hs-identifier hs-var">logLevel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-155"></span><span>            </span><span class="annot"><a href="Charon.Runner.Env.html#MkLogFile"><span class="hs-identifier hs-type">MkLogFile</span></a></span><span>
</span><span id="line-156"></span><span>              </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Handle
$sel:handle:MkLogFile :: Handle
handle :: Handle
</span><a href="Charon.Runner.Env.html#%24sel%3Ahandle%3AMkLogFile"><span class="hs-identifier hs-var hs-var">handle</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-157"></span><span>                </span><span class="annot"><span class="annottext">LogLevel
$sel:logLevel:MkLogFile :: LogLevel
logLevel :: LogLevel
</span><a href="Charon.Runner.Env.html#%24sel%3AlogLevel%3AMkLogFile"><span class="hs-identifier hs-var hs-var">logLevel</span></a></span><span>
</span><span id="line-158"></span><span>              </span><span class="hs-special">}</span><span>
</span><span id="line-159"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">Env m -&gt; m a
</span><a href="#local-6989586621679644803"><span class="hs-identifier hs-var">onEnv</span></a></span><span>
</span><span id="line-160"></span><span>          </span><span class="annot"><span class="annottext">(Env m -&gt; m a) -&gt; Env m -&gt; m a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><a href="Charon.Runner.Env.html#MkEnv"><span class="hs-identifier hs-type">MkEnv</span></a></span><span>
</span><span id="line-161"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome
$sel:trashHome:MkEnv :: PathI 'TrashHome
trashHome :: PathI 'TrashHome
</span><a href="Charon.Runner.Env.html#%24sel%3AtrashHome%3AMkEnv"><span class="hs-identifier hs-var hs-var">trashHome</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-162"></span><span>              </span><span class="annot"><span class="annottext">$sel:backend:MkEnv :: Backend
</span><a href="Charon.Runner.Env.html#%24sel%3Abackend%3AMkEnv"><span class="hs-identifier hs-var">backend</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Backend -&gt; Maybe Backend -&gt; Backend
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">Backend
</span><a href="Charon.Backend.Data.html#BackendCbor"><span class="hs-identifier hs-var">BackendCbor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TomlConfig
</span><a href="#local-6989586621679644802"><span class="hs-identifier hs-var">mergedConfig</span></a></span><span> </span><span class="annot"><span class="annottext">TomlConfig
-&gt; Optic' A_Lens NoIx TomlConfig (Maybe Backend) -&gt; Maybe Backend
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/4wakibz21ahaapk6h38p2l10j9a6z58i-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx TomlConfig (Maybe Backend)
</span><span class="">#backend</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-163"></span><span>              </span><span class="annot"><span class="annottext">$sel:logEnv:MkEnv :: LogEnv m
</span><a href="Charon.Runner.Env.html#%24sel%3AlogEnv%3AMkEnv"><span class="hs-identifier hs-var">logEnv</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-164"></span><span>                </span><span class="annot"><a href="Charon.Runner.Env.html#MkLogEnv"><span class="hs-identifier hs-type">MkLogEnv</span></a></span><span>
</span><span id="line-165"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Maybe (LogFile m)
$sel:logFile:MkLogEnv :: Maybe (LogFile m)
logFile :: Maybe (LogFile m)
</span><a href="Charon.Runner.Env.html#%24sel%3AlogFile%3AMkLogEnv"><span class="hs-identifier hs-var hs-var">logFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-166"></span><span>                    </span><span class="annot"><span class="annottext">$sel:logNamespace:MkLogEnv :: Namespace
</span><a href="Charon.Runner.Env.html#%24sel%3AlogNamespace%3AMkLogEnv"><span class="hs-identifier hs-var">logNamespace</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Namespace
</span><span class="hs-string">&quot;main&quot;</span></span><span>
</span><span id="line-167"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-168"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span class="hs-comment">-- | Parses CLI 'Args' and optional 'TomlConfig' to produce the user</span><span>
</span><span id="line-171"></span><span class="hs-comment">-- configuration. For values shared between the CLI and Toml file, the CLI</span><span>
</span><span id="line-172"></span><span class="hs-comment">-- takes priority.</span><span>
</span><span id="line-173"></span><span class="hs-comment">--</span><span>
</span><span id="line-174"></span><span class="hs-comment">-- For example, if both the CLI and Toml file specify the trash home, then</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- the CLI's value will be used.</span><span>
</span><span id="line-176"></span><span id="local-6989586621679644183"><span class="annot"><a href="Charon.Runner.html#getConfiguration"><span class="hs-identifier hs-type">getConfiguration</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-178"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.FileReader.html#MonadFileReader"><span class="hs-identifier hs-type">MonadFileReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644183"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-179"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-optparse-0.1-4e037383561ff7fea88981d0257a2f768f1974347ba7739709ad65ce1d2914e0/share/doc/html/src/Effects.Optparse.html#MonadOptparse"><span class="hs-identifier hs-type">MonadOptparse</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644183"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-180"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644183"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-181"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679644183"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-183"></span><span>  </span><span class="annot"><a href="#local-6989586621679644183"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Runner.Toml.html#TomlConfig"><span class="hs-identifier hs-type">TomlConfig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Runner.Command.html#CommandP2"><span class="hs-identifier hs-type">CommandP2</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-184"></span><span id="getConfiguration"><span class="annot"><span class="annottext">getConfiguration :: forall (m :: * -&gt; *).
(HasCallStack, MonadFileReader m, MonadOptparse m,
 MonadPathReader m, MonadThrow m) =&gt;
m (TomlConfig, CommandP2)
</span><a href="Charon.Runner.html#getConfiguration"><span class="hs-identifier hs-var hs-var">getConfiguration</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-185"></span><span>  </span><span class="hs-comment">-- get CLI args</span><span>
</span><span id="line-186"></span><span>  </span><span id="local-6989586621679644861"><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621679644861"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Args
forall (m :: * -&gt; *). MonadOptparse m =&gt; m Args
</span><a href="Charon.Runner.Args.html#getArgs"><span class="hs-identifier hs-var">getArgs</span></a></span><span>
</span><span id="line-187"></span><span>
</span><span id="line-188"></span><span>  </span><span class="hs-comment">-- get toml config</span><span>
</span><span id="line-189"></span><span>  </span><span id="local-6989586621679644862"><span class="annot"><span class="annottext">TomlConfig
</span><a href="#local-6989586621679644862"><span class="hs-identifier hs-var">tomlConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621679644861"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">Args -&gt; Optic' A_Lens NoIx Args TomlConfigPath -&gt; TomlConfigPath
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/4wakibz21ahaapk6h38p2l10j9a6z58i-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' A_Lens NoIx Args TomlConfigPath
</span><span class="">#tomlConfigPath</span></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-comment">-- 1. explicit toml config path given: read</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><a href="Charon.Runner.Args.html#TomlPath"><span class="hs-identifier hs-type">TomlPath</span></a></span><span> </span><span id="local-6989586621679644863"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679644863"><span class="hs-identifier hs-var">tomlPath</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; m TomlConfig
forall {m :: * -&gt; *} {b}.
(MonadFileReader m, MonadThrow m, DecodeTOML b) =&gt;
OsPath -&gt; m b
</span><a href="#local-6989586621679644864"><span class="hs-identifier hs-var">readConfig</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679644863"><span class="hs-identifier hs-var">tomlPath</span></a></span><span>
</span><span id="line-192"></span><span>    </span><span class="hs-comment">-- no toml config path given...</span><span>
</span><span id="line-193"></span><span>    </span><span class="annot"><span class="annottext">TomlConfigPath
</span><a href="Charon.Runner.Args.html#TomlDefault"><span class="hs-identifier hs-var">TomlDefault</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-194"></span><span>      </span><span id="local-6989586621679644865"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679644865"><span class="hs-identifier hs-var">xdgConfig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; m OsPath
forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m) =&gt;
OsPath -&gt; m OsPath
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#getXdgConfig"><span class="hs-identifier hs-var">getXdgConfig</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="Charon.Runner.html#charonPath"><span class="hs-identifier hs-var">charonPath</span></a></span><span>
</span><span id="line-195"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679644868"><span class="annot"><span class="annottext">defPath :: OsPath
</span><a href="#local-6989586621679644868"><span class="hs-identifier hs-var hs-var">defPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679644865"><span class="hs-identifier hs-var">xdgConfig</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; OsPath -&gt; OsPath
</span><span class="hs-operator hs-var">&lt;/&gt;</span></span><span> </span><span class="annot"><span class="">[osp|config.toml|]</span></span><span>
</span><span id="line-196"></span><span>      </span><span id="local-6989586621679644874"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679644874"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; m Bool
forall (m :: * -&gt; *).
(MonadPathReader m, HasCallStack) =&gt;
OsPath -&gt; m Bool
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679644868"><span class="hs-identifier hs-var">defPath</span></a></span><span>
</span><span id="line-197"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679644874"><span class="hs-identifier hs-var">exists</span></a></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- 2. config exists at default path: read</span><span>
</span><span id="line-199"></span><span>          </span><span class="annot"><span class="annottext">OsPath -&gt; m TomlConfig
forall {m :: * -&gt; *} {b}.
(MonadFileReader m, MonadThrow m, DecodeTOML b) =&gt;
OsPath -&gt; m b
</span><a href="#local-6989586621679644864"><span class="hs-identifier hs-var">readConfig</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679644868"><span class="hs-identifier hs-var">defPath</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-comment">-- 3. no config exists: return default (empty)</span><span>
</span><span id="line-201"></span><span>          </span><span class="annot"><span class="annottext">TomlConfig -&gt; m TomlConfig
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TomlConfig
</span><a href="Charon.Runner.Toml.html#defaultTomlConfig"><span class="hs-identifier hs-var">defaultTomlConfig</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span class="hs-comment">-- 4. toml explicitly disabled</span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">TomlConfigPath
</span><a href="Charon.Runner.Args.html#TomlNone"><span class="hs-identifier hs-var">TomlNone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TomlConfig -&gt; m TomlConfig
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">TomlConfig
</span><a href="Charon.Runner.Toml.html#defaultTomlConfig"><span class="hs-identifier hs-var">defaultTomlConfig</span></a></span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>  </span><span class="hs-comment">-- merge shared CLI and toml values</span><span>
</span><span id="line-206"></span><span>  </span><span class="annot"><span class="annottext">(TomlConfig, CommandP2) -&gt; m (TomlConfig, CommandP2)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">((TomlConfig, CommandP2) -&gt; m (TomlConfig, CommandP2))
-&gt; (TomlConfig, CommandP2) -&gt; m (TomlConfig, CommandP2)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Args -&gt; TomlConfig -&gt; (TomlConfig, CommandP2)
</span><a href="Charon.Runner.Toml.html#mergeConfigs"><span class="hs-identifier hs-var">mergeConfigs</span></a></span><span> </span><span class="annot"><span class="annottext">Args
</span><a href="#local-6989586621679644861"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">TomlConfig
</span><a href="#local-6989586621679644862"><span class="hs-identifier hs-var">tomlConfig</span></a></span><span>
</span><span id="line-207"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-208"></span><span>    </span><span id="local-6989586621679644864"><span class="annot"><span class="annottext">readConfig :: OsPath -&gt; m b
</span><a href="#local-6989586621679644864"><span class="hs-identifier hs-var hs-var">readConfig</span></a></span></span><span> </span><span id="local-6989586621679644903"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679644903"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-209"></span><span>      </span><span id="local-6989586621679644904"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679644904"><span class="hs-identifier hs-var">contents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; m Text
forall (m :: * -&gt; *).
(HasCallStack, MonadFileReader m, MonadThrow m) =&gt;
OsPath -&gt; m Text
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.FileReader.html#readFileUtf8ThrowM"><span class="hs-identifier hs-var">readFileUtf8ThrowM</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679644903"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-210"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Either TOMLError b
forall a. DecodeTOML a =&gt; Text -&gt; Either TOMLError a
</span><a href="file:///nix/store/gfwzh9i8rj34931p88bivbfkk2k4cn2d-toml-reader-0.2.1.0-doc/share/doc/toml-reader-0.2.1.0/html/src/TOML.Decode.html#decode"><span class="hs-identifier hs-var">TOML.decode</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679644904"><span class="hs-identifier hs-var">contents</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-211"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679644907"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679644907"><span class="hs-identifier hs-var">cfg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; m b
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679644907"><span class="hs-identifier hs-var">cfg</span></a></span><span>
</span><span id="line-212"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679644908"><span class="annot"><span class="annottext">TOMLError
</span><a href="#local-6989586621679644908"><span class="hs-identifier hs-var">tomlErr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TOMLError -&gt; m b
forall (m :: * -&gt; *) e a.
(Exception e, HasCallStack, MonadThrow m) =&gt;
e -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-exceptions-0.1-cbc6c6992b43b60e49e859c21827717f4c8f4d9ff6ce5ae6d908553d0e8694a2/share/doc/html/src/Effects.Exception.html#throwCS"><span class="hs-identifier hs-var">throwCS</span></a></span><span> </span><span class="annot"><span class="annottext">TOMLError
</span><a href="#local-6989586621679644908"><span class="hs-identifier hs-var">tomlErr</span></a></span><span>
</span><span id="line-213"></span><span>
</span><span id="line-214"></span><span id="local-6989586621679644220"><span id="local-6989586621679644221"><span class="annot"><a href="Charon.Runner.html#printIndex"><span class="hs-identifier hs-type">printIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Env.html#HasBackend"><span class="hs-identifier hs-type">HasBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644220"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-216"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-217"></span><span>    </span><span class="annot"><a href="Charon.Env.html#HasTrashHome"><span class="hs-identifier hs-type">HasTrashHome</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644220"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-218"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-async-0.1-ef1cb19e8fbf2dc116242b18cd3b9e7b5c92122705eb34b11f5acc170f2280d5/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644221"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-219"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679644221"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-220"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.FileReader.html#MonadFileReader"><span class="hs-identifier hs-type">MonadFileReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644221"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-221"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#MonadLoggerNS"><span class="hs-identifier hs-type">MonadLoggerNS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644221"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-222"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644221"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-223"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-unix-compat-0.1-9d56e686bd87cf957ed28aa8665c62fc4afee54f74eb31f0de31da53bf4c3734/share/doc/html/src/Effects.System.PosixCompat.html#MonadPosixCompat"><span class="hs-identifier hs-type">MonadPosixCompat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644221"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-224"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679644220"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644221"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-225"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#MonadTerminal"><span class="hs-identifier hs-type">MonadTerminal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644221"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-226"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-227"></span><span>  </span><span class="annot"><a href="Charon.Runner.Command.List.html#ListCmdP2"><span class="hs-identifier hs-type">ListCmdP2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-228"></span><span>  </span><span class="annot"><a href="#local-6989586621679644221"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-229"></span><span id="printIndex"><span class="annot"><span class="annottext">printIndex :: forall env (m :: * -&gt; *).
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadCatch m, MonadFileReader m, MonadLoggerNS m,
 MonadPathReader m, MonadPosixCompat m, MonadReader env m,
 MonadTerminal m) =&gt;
ListCmd 'Phase2 -&gt; m ()
</span><a href="Charon.Runner.html#printIndex"><span class="hs-identifier hs-var hs-var">printIndex</span></a></span></span><span> </span><span id="local-6989586621679644944"><span class="annot"><span class="annottext">ListCmd 'Phase2
</span><a href="#local-6989586621679644944"><span class="hs-identifier hs-var">listCmd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>  </span><span id="local-6989586621679644945"><span class="annot"><span class="annottext">Index
</span><a href="#local-6989586621679644945"><span class="hs-identifier hs-var">index</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m Index
forall env (m :: * -&gt; *).
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadCatch m, MonadFileReader m, MonadLoggerNS m,
 MonadPathReader m, MonadPosixCompat m, MonadReader env m,
 MonadTerminal m) =&gt;
m Index
</span><a href="Charon.html#getIndex"><span class="hs-identifier hs-var">Charon.getIndex</span></a></span><span>
</span><span id="line-231"></span><span>  </span><span id="local-6989586621679644947"><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679644947"><span class="hs-identifier hs-var">formatted</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ListCmd 'Phase2 -&gt; Index -&gt; m Text
forall (m :: * -&gt; *).
(HasCallStack, MonadAsync m, MonadCatch m, MonadLoggerNS m,
 MonadTerminal m) =&gt;
ListCmd 'Phase2 -&gt; Index -&gt; m Text
</span><a href="Charon.Data.Index.html#formatIndex"><span class="hs-identifier hs-var">Index.formatIndex</span></a></span><span> </span><span class="annot"><span class="annottext">ListCmd 'Phase2
</span><a href="#local-6989586621679644944"><span class="hs-identifier hs-var">listCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Index
</span><a href="#local-6989586621679644945"><span class="hs-identifier hs-var">index</span></a></span><span>
</span><span id="line-232"></span><span>  </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall (m :: * -&gt; *).
(HasCallStack, MonadTerminal m) =&gt;
Text -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#putTextLn"><span class="hs-identifier hs-var">putTextLn</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><a href="#local-6989586621679644947"><span class="hs-identifier hs-var">formatted</span></a></span><span>
</span><span id="line-233"></span><span>
</span><span id="line-234"></span><span id="local-6989586621679644222"><span id="local-6989586621679644223"><span class="annot"><a href="Charon.Runner.html#printMetadata"><span class="hs-identifier hs-type">printMetadata</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-235"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Env.html#HasBackend"><span class="hs-identifier hs-type">HasBackend</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644222"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-236"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-237"></span><span>    </span><span class="annot"><a href="Charon.Env.html#HasTrashHome"><span class="hs-identifier hs-type">HasTrashHome</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644222"><span class="hs-identifier hs-type">env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-238"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-async-0.1-ef1cb19e8fbf2dc116242b18cd3b9e7b5c92122705eb34b11f5acc170f2280d5/share/doc/html/src/Effects.Concurrent.Async.html#MonadAsync"><span class="hs-identifier hs-type">MonadAsync</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644223"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-239"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679644223"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-240"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.FileReader.html#MonadFileReader"><span class="hs-identifier hs-type">MonadFileReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644223"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#MonadLoggerNS"><span class="hs-identifier hs-type">MonadLoggerNS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644223"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644223"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-243"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-unix-compat-0.1-9d56e686bd87cf957ed28aa8665c62fc4afee54f74eb31f0de31da53bf4c3734/share/doc/html/src/Effects.System.PosixCompat.html#MonadPosixCompat"><span class="hs-identifier hs-type">MonadPosixCompat</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644223"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-244"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadReader</span></span><span> </span><span class="annot"><a href="#local-6989586621679644222"><span class="hs-identifier hs-type">env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644223"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-245"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#MonadTerminal"><span class="hs-identifier hs-type">MonadTerminal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644223"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-247"></span><span>  </span><span class="annot"><a href="#local-6989586621679644223"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-248"></span><span id="printMetadata"><span class="annot"><span class="annottext">printMetadata :: forall env (m :: * -&gt; *).
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadCatch m, MonadFileReader m, MonadLoggerNS m,
 MonadPathReader m, MonadPosixCompat m, MonadReader env m,
 MonadTerminal m) =&gt;
m ()
</span><a href="Charon.Runner.html#printMetadata"><span class="hs-identifier hs-var hs-var">printMetadata</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m Metadata
forall (m :: * -&gt; *) env.
(HasBackend env, HasCallStack, HasTrashHome env, MonadAsync m,
 MonadCatch m, MonadFileReader m, MonadLoggerNS m,
 MonadPathReader m, MonadPosixCompat m, MonadReader env m,
 MonadTerminal m) =&gt;
m Metadata
</span><a href="Charon.html#getMetadata"><span class="hs-identifier hs-var">Charon.getMetadata</span></a></span><span> </span><span class="annot"><span class="annottext">m Metadata -&gt; (Metadata -&gt; m ()) -&gt; m ()
forall a b. m a -&gt; (a -&gt; m b) -&gt; m b
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><span class="hs-operator hs-var">&gt;&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Metadata -&gt; m ()
forall a (m :: * -&gt; *). (Pretty a, MonadTerminal m) =&gt; a -&gt; m ()
</span><a href="Charon.Runner.html#prettyDel"><span class="hs-identifier hs-var">prettyDel</span></a></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span id="local-6989586621679644333"><span id="local-6989586621679644334"><span class="annot"><a href="Charon.Runner.html#prettyDel"><span class="hs-identifier hs-type">prettyDel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/8dbdwk0963kxpz5byjy6s9y2sn57fdk7-prettyprinter-1.7.1-doc/share/doc/prettyprinter-1.7.1/html/src/Prettyprinter.Internal.html#Pretty"><span class="hs-identifier hs-type">Pretty</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644333"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#MonadTerminal"><span class="hs-identifier hs-type">MonadTerminal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644334"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679644333"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679644334"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-251"></span><span id="prettyDel"><span class="annot"><span class="annottext">prettyDel :: forall a (m :: * -&gt; *). (Pretty a, MonadTerminal m) =&gt; a -&gt; m ()
</span><a href="Charon.Runner.html#prettyDel"><span class="hs-identifier hs-var hs-var">prettyDel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall (m :: * -&gt; *).
(HasCallStack, MonadTerminal m) =&gt;
Text -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#putTextLn"><span class="hs-identifier hs-var">putTextLn</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; (a -&gt; Text) -&gt; a -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Text
forall a. Pretty a =&gt; a -&gt; Text
</span><a href="Charon.Utils.html#renderPretty"><span class="hs-identifier hs-var">U.renderPretty</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="hs-comment">-- | If the argument is given, returns it. Otherwise searches for the default</span><span>
</span><span id="line-254"></span><span class="hs-comment">-- trash location.</span><span>
</span><span id="line-255"></span><span id="local-6989586621679644282"><span class="annot"><a href="Charon.Runner.html#trashOrDefault"><span class="hs-identifier hs-type">trashOrDefault</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-256"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-257"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644282"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-258"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-259"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-260"></span><span>  </span><span class="annot"><a href="#local-6989586621679644282"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-261"></span><span id="trashOrDefault"><span class="annot"><span class="annottext">trashOrDefault :: forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m) =&gt;
Maybe (PathI 'TrashHome) -&gt; m (PathI 'TrashHome)
</span><a href="Charon.Runner.html#trashOrDefault"><span class="hs-identifier hs-var hs-var">trashOrDefault</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m (PathI 'TrashHome)
-&gt; (PathI 'TrashHome -&gt; m (PathI 'TrashHome))
-&gt; Maybe (PathI 'TrashHome)
-&gt; m (PathI 'TrashHome)
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><span class="hs-identifier hs-var">maybe</span></span><span> </span><span class="annot"><span class="annottext">m (PathI 'TrashHome)
forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m) =&gt;
m (PathI 'TrashHome)
</span><a href="Charon.Runner.html#getTrashHome"><span class="hs-identifier hs-var">getTrashHome</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome -&gt; m (PathI 'TrashHome)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span>
</span><span id="line-262"></span><span>
</span><span id="line-263"></span><span class="annot"><span class="hs-comment">-- | Retrieves the default trash directory.</span></span><span>
</span><span id="line-264"></span><span id="local-6989586621679644341"><span class="annot"><a href="Charon.Runner.html#getTrashHome"><span class="hs-identifier hs-type">getTrashHome</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-265"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644341"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-268"></span><span>  </span><span class="annot"><a href="#local-6989586621679644341"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-269"></span><span id="getTrashHome"><span class="annot"><span class="annottext">getTrashHome :: forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m) =&gt;
m (PathI 'TrashHome)
</span><a href="Charon.Runner.html#getTrashHome"><span class="hs-identifier hs-var hs-var">getTrashHome</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; PathI 'TrashHome
forall (i :: PathIndex). OsPath -&gt; PathI i
</span><a href="Charon.Data.Paths.html#MkPathI"><span class="hs-identifier hs-var">MkPathI</span></a></span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; PathI 'TrashHome) -&gt; m OsPath -&gt; m (PathI 'TrashHome)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OsPath -&gt; m OsPath
forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m) =&gt;
OsPath -&gt; m OsPath
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#getXdgData"><span class="hs-identifier hs-var">getXdgData</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="Charon.Runner.html#charonPath"><span class="hs-identifier hs-var">charonPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-270"></span><span>
</span><span id="line-271"></span><span id="local-6989586621679644288"><span id="local-6989586621679644289"><span class="annot"><a href="Charon.Runner.html#withLogHandle"><span class="hs-identifier hs-type">withLogHandle</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.FileWriter.html#MonadFileWriter"><span class="hs-identifier hs-type">MonadFileWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644288"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.HandleWriter.html#MonadHandleWriter"><span class="hs-identifier hs-type">MonadHandleWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644288"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-275"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644288"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-276"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathWriter.html#MonadPathWriter"><span class="hs-identifier hs-type">MonadPathWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644288"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#MonadTerminal"><span class="hs-identifier hs-type">MonadTerminal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644288"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-278"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-279"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Charon.Runner.FileSizeMode.html#FileSizeMode"><span class="hs-identifier hs-type">FileSizeMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Handle</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679644288"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644289"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-281"></span><span>  </span><span class="annot"><a href="#local-6989586621679644288"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644289"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-282"></span><span id="withLogHandle"><span class="annot"><span class="annottext">withLogHandle :: forall (m :: * -&gt; *) a.
(HasCallStack, MonadFileWriter m, MonadHandleWriter m,
 MonadPathReader m, MonadPathWriter m, MonadTerminal m) =&gt;
Maybe FileSizeMode -&gt; (Handle -&gt; m a) -&gt; m a
</span><a href="Charon.Runner.html#withLogHandle"><span class="hs-identifier hs-var hs-var">withLogHandle</span></a></span></span><span> </span><span id="local-6989586621679645036"><span class="annot"><span class="annottext">Maybe FileSizeMode
</span><a href="#local-6989586621679645036"><span class="hs-identifier hs-var">sizeMode</span></a></span></span><span> </span><span id="local-6989586621679645037"><span class="annot"><span class="annottext">Handle -&gt; m a
</span><a href="#local-6989586621679645037"><span class="hs-identifier hs-var">onHandle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-283"></span><span>  </span><span id="local-6989586621679645038"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645038"><span class="hs-identifier hs-var">xdgState</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; m OsPath
forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m) =&gt;
OsPath -&gt; m OsPath
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#getXdgState"><span class="hs-identifier hs-var">getXdgState</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="Charon.Runner.html#charonPath"><span class="hs-identifier hs-var">charonPath</span></a></span><span>
</span><span id="line-284"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; OsPath -&gt; m ()
forall (m :: * -&gt; *).
(MonadPathWriter m, HasCallStack) =&gt;
Bool -&gt; OsPath -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathWriter.html#createDirectoryIfMissing"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645038"><span class="hs-identifier hs-var">xdgState</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#MkPathI"><span class="hs-identifier hs-type">MkPathI</span></a></span><span> </span><span id="local-6989586621679645040"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645040"><span class="hs-identifier hs-var">logPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (PathI 'TrashLog)
forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m) =&gt;
m (PathI 'TrashLog)
</span><a href="Charon.Env.html#getTrashLog"><span class="hs-identifier hs-var">Env.getTrashLog</span></a></span><span>
</span><span id="line-287"></span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><span class="annottext">OsPath -&gt; Maybe FileSizeMode -&gt; m ()
forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m, MonadPathWriter m,
 MonadTerminal m) =&gt;
OsPath -&gt; Maybe FileSizeMode -&gt; m ()
</span><a href="Charon.Runner.html#handleLogSize"><span class="hs-identifier hs-var">handleLogSize</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645040"><span class="hs-identifier hs-var">logPath</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FileSizeMode
</span><a href="#local-6989586621679645036"><span class="hs-identifier hs-var">sizeMode</span></a></span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>  </span><span class="annot"><span class="annottext">OsPath -&gt; IOMode -&gt; (Handle -&gt; m a) -&gt; m a
forall a.
HasCallStack =&gt;
OsPath -&gt; IOMode -&gt; (Handle -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a.
(MonadHandleWriter m, HasCallStack) =&gt;
OsPath -&gt; IOMode -&gt; (Handle -&gt; m a) -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.HandleWriter.html#withBinaryFile"><span class="hs-identifier hs-var">withBinaryFile</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645040"><span class="hs-identifier hs-var">logPath</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><span class="hs-identifier hs-var">AppendMode</span></span><span> </span><span class="annot"><span class="annottext">Handle -&gt; m a
</span><a href="#local-6989586621679645037"><span class="hs-identifier hs-var">onHandle</span></a></span><span>
</span><span id="line-291"></span><span>
</span><span id="line-292"></span><span id="local-6989586621679644353"><span class="annot"><a href="Charon.Runner.html#handleLogSize"><span class="hs-identifier hs-type">handleLogSize</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-293"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-294"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644353"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-295"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathWriter.html#MonadPathWriter"><span class="hs-identifier hs-type">MonadPathWriter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644353"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-296"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#MonadTerminal"><span class="hs-identifier hs-type">MonadTerminal</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679644353"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-299"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="annot"><a href="Charon.Runner.FileSizeMode.html#FileSizeMode"><span class="hs-identifier hs-type">FileSizeMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-300"></span><span>  </span><span class="annot"><a href="#local-6989586621679644353"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-301"></span><span id="handleLogSize"><span class="annot"><span class="annottext">handleLogSize :: forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m, MonadPathWriter m,
 MonadTerminal m) =&gt;
OsPath -&gt; Maybe FileSizeMode -&gt; m ()
</span><a href="Charon.Runner.html#handleLogSize"><span class="hs-identifier hs-var hs-var">handleLogSize</span></a></span></span><span> </span><span id="local-6989586621679645090"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645090"><span class="hs-identifier hs-var">logFile</span></a></span></span><span> </span><span id="local-6989586621679645091"><span class="annot"><span class="annottext">Maybe FileSizeMode
</span><a href="#local-6989586621679645091"><span class="hs-identifier hs-var">msizeMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-302"></span><span>  </span><span id="local-6989586621679645092"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679645092"><span class="hs-identifier hs-var">logExists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; m Bool
forall (m :: * -&gt; *).
(MonadPathReader m, HasCallStack) =&gt;
OsPath -&gt; m Bool
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645090"><span class="hs-identifier hs-var">logFile</span></a></span><span>
</span><span id="line-303"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679645092"><span class="hs-identifier hs-var">logExists</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-304"></span><span>    </span><span id="local-6989586621679645094"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679645094"><span class="hs-identifier hs-var">logSize</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; m Integer
forall (m :: * -&gt; *).
(MonadPathReader m, HasCallStack) =&gt;
OsPath -&gt; m Integer
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#getFileSize"><span class="hs-identifier hs-var">getFileSize</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645090"><span class="hs-identifier hs-var">logFile</span></a></span><span>
</span><span id="line-305"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679645096"><span class="annot"><span class="annottext">logSize' :: Bytes 'B Natural
</span><a href="#local-6989586621679645096"><span class="hs-identifier hs-var hs-var">logSize'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Natural -&gt; Bytes 'B Natural
forall (s :: Size) n. n -&gt; Bytes s n
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/si-bytes-0.1-97cb24a33de91ba49ee0c56be2863dcf522540262bce46ec251c99d0bda0642a/share/doc/html/src/Data.Bytes.Internal.html#MkBytes"><span class="hs-identifier hs-var">MkBytes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; Natural
forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621679645094"><span class="hs-identifier hs-var">logSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-306"></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FileSizeMode
</span><a href="#local-6989586621679645098"><span class="hs-identifier hs-var">sizeMode</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-308"></span><span>      </span><span class="annot"><a href="Charon.Runner.FileSizeMode.html#FileSizeModeWarn"><span class="hs-identifier hs-type">FileSizeModeWarn</span></a></span><span> </span><span id="local-6989586621679645100"><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645100"><span class="hs-identifier hs-var">warnSize</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-309"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645096"><span class="hs-identifier hs-var">logSize'</span></a></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural -&gt; Bytes 'B Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645100"><span class="hs-identifier hs-var">warnSize</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-310"></span><span>          </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall (m :: * -&gt; *).
(HasCallStack, MonadTerminal m) =&gt;
Text -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#putTextLn"><span class="hs-identifier hs-var">putTextLn</span></a></span><span>
</span><span id="line-311"></span><span>          </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural -&gt; OsPath -&gt; Bytes 'B Natural -&gt; Text
</span><a href="#local-6989586621679645102"><span class="hs-identifier hs-var">sizeWarning</span></a></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645100"><span class="hs-identifier hs-var">warnSize</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645090"><span class="hs-identifier hs-var">logFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645096"><span class="hs-identifier hs-var">logSize'</span></a></span><span>
</span><span id="line-312"></span><span>      </span><span class="annot"><a href="Charon.Runner.FileSizeMode.html#FileSizeModeDelete"><span class="hs-identifier hs-type">FileSizeModeDelete</span></a></span><span> </span><span id="local-6989586621679645104"><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645104"><span class="hs-identifier hs-var">delSize</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-313"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645096"><span class="hs-identifier hs-var">logSize'</span></a></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural -&gt; Bytes 'B Natural -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645104"><span class="hs-identifier hs-var">delSize</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-314"></span><span>          </span><span class="annot"><span class="annottext">Text -&gt; m ()
forall (m :: * -&gt; *).
(HasCallStack, MonadTerminal m) =&gt;
Text -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-terminal-0.1-e7543ffa04a83cd49297a1644b24098121a9ea2eb8dc03312d54c084a2c39a68/share/doc/html/src/Effects.System.Terminal.html#putTextLn"><span class="hs-identifier hs-var">putTextLn</span></a></span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural -&gt; OsPath -&gt; Bytes 'B Natural -&gt; Text
</span><a href="#local-6989586621679645102"><span class="hs-identifier hs-var">sizeWarning</span></a></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645104"><span class="hs-identifier hs-var">delSize</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645090"><span class="hs-identifier hs-var">logFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645096"><span class="hs-identifier hs-var">logSize'</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; Deleting log.&quot;</span></span><span>
</span><span id="line-315"></span><span>          </span><span class="annot"><span class="annottext">OsPath -&gt; m ()
forall (m :: * -&gt; *).
(MonadPathWriter m, HasCallStack) =&gt;
OsPath -&gt; m ()
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathWriter.html#removeFile"><span class="hs-identifier hs-var">removeFile</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645090"><span class="hs-identifier hs-var">logFile</span></a></span><span>
</span><span id="line-316"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-317"></span><span>    </span><span id="local-6989586621679645098"><span class="annot"><span class="annottext">sizeMode :: FileSizeMode
</span><a href="#local-6989586621679645098"><span class="hs-identifier hs-var hs-var">sizeMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FileSizeMode -&gt; Maybe FileSizeMode -&gt; FileSizeMode
forall a. a -&gt; Maybe a -&gt; a
</span><span class="hs-identifier hs-var">fromMaybe</span></span><span> </span><span class="annot"><span class="annottext">FileSizeMode
</span><a href="Charon.Runner.FileSizeMode.html#defaultSizeMode"><span class="hs-identifier hs-var">FileSizeMode.defaultSizeMode</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FileSizeMode
</span><a href="#local-6989586621679645091"><span class="hs-identifier hs-var">msizeMode</span></a></span><span>
</span><span id="line-318"></span><span>    </span><span id="local-6989586621679645102"><span class="annot"><span class="annottext">sizeWarning :: Bytes 'B Natural -&gt; OsPath -&gt; Bytes 'B Natural -&gt; Text
</span><a href="#local-6989586621679645102"><span class="hs-identifier hs-var hs-var">sizeWarning</span></a></span></span><span> </span><span id="local-6989586621679645106"><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645106"><span class="hs-identifier hs-var">warnSize</span></a></span></span><span> </span><span id="local-6989586621679645107"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645107"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span id="local-6989586621679645108"><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645108"><span class="hs-identifier hs-var">fileSize</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-319"></span><span>      </span><span class="annot"><span class="annottext">[Text] -&gt; Text
forall a. Monoid a =&gt; [a] -&gt; a
</span><span class="hs-identifier hs-var">mconcat</span></span><span>
</span><span id="line-320"></span><span>        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Warning: log dir &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-321"></span><span>          </span><span class="annot"><span class="annottext">OsPath -&gt; Text
</span><a href="Charon.Prelude.html#decodeOsToFpDisplayExT"><span class="hs-identifier hs-var">decodeOsToFpDisplayExT</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679645107"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; has size: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-323"></span><span>          </span><span class="annot"><span class="annottext">Bytes 'B Natural -&gt; Text
</span><a href="#local-6989586621679645110"><span class="hs-identifier hs-var">formatBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645108"><span class="hs-identifier hs-var">fileSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;, but specified threshold is: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-325"></span><span>          </span><span class="annot"><span class="annottext">Bytes 'B Natural -&gt; Text
</span><a href="#local-6989586621679645110"><span class="hs-identifier hs-var">formatBytes</span></a></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Natural
</span><a href="#local-6989586621679645106"><span class="hs-identifier hs-var">warnSize</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-326"></span><span>          </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;.&quot;</span></span><span>
</span><span id="line-327"></span><span>        </span><span class="hs-special">]</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span>    </span><span id="local-6989586621679645110"><span class="annot"><span class="annottext">formatBytes :: Bytes 'B Natural -&gt; Text
</span><a href="#local-6989586621679645110"><span class="hs-identifier hs-var hs-var">formatBytes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-330"></span><span>      </span><span class="annot"><span class="annottext">BaseFormatter (Unwrapped (Norm (Bytes 'B Double)))
-&gt; SizedFormatter -&gt; Norm (Bytes 'B Double) -&gt; Text
forall a.
(Formatter (BaseFormatter (Unwrapped a)), PrintfArg (Unwrapped a),
 Sized a, Unwrapper a) =&gt;
BaseFormatter (Unwrapped a) -&gt; SizedFormatter -&gt; a -&gt; Text
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/si-bytes-0.1-97cb24a33de91ba49ee0c56be2863dcf522540262bce46ec251c99d0bda0642a/share/doc/html/src/Data.Bytes.Formatting.html#formatSized"><span class="hs-identifier hs-var">Bytes.formatSized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Word8 -&gt; FloatingFormatter
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/si-bytes-0.1-97cb24a33de91ba49ee0c56be2863dcf522540262bce46ec251c99d0bda0642a/share/doc/html/src/Data.Bytes.Formatting.Base.html#MkFloatingFormatter"><span class="hs-identifier hs-var">MkFloatingFormatter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word8 -&gt; Maybe Word8
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Word8
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SizedFormatter
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/si-bytes-0.1-97cb24a33de91ba49ee0c56be2863dcf522540262bce46ec251c99d0bda0642a/share/doc/html/src/Data.Bytes.Formatting.Size.html#sizedFormatterNatural"><span class="hs-identifier hs-var">Bytes.sizedFormatterNatural</span></a></span><span>
</span><span id="line-331"></span><span>        </span><span class="annot"><span class="annottext">(Norm (Bytes 'B Double) -&gt; Text)
-&gt; (Bytes 'B Natural -&gt; Norm (Bytes 'B Double))
-&gt; Bytes 'B Natural
-&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Bytes 'B Double -&gt; Norm (Bytes 'B Double)
forall a. Normalize a =&gt; a -&gt; Norm a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/si-bytes-0.1-97cb24a33de91ba49ee0c56be2863dcf522540262bce46ec251c99d0bda0642a/share/doc/html/src/Data.Bytes.Class.Normalize.html#normalize"><span class="hs-identifier hs-var">Bytes.normalize</span></a></span><span>
</span><span id="line-332"></span><span>        </span><span class="hs-comment">-- Convert to double _before_ normalizing. We may lose some precision</span><span>
</span><span id="line-333"></span><span>        </span><span class="hs-comment">-- here, but it is better than normalizing a natural, which will</span><span>
</span><span id="line-334"></span><span>        </span><span class="hs-comment">-- truncate (i.e. greater precision loss).</span><span>
</span><span id="line-335"></span><span>        </span><span class="annot"><span class="annottext">(Bytes 'B Double -&gt; Norm (Bytes 'B Double))
-&gt; (Bytes 'B Natural -&gt; Bytes 'B Double)
-&gt; Bytes 'B Natural
-&gt; Norm (Bytes 'B Double)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">(Natural -&gt; Double) -&gt; Bytes 'B Natural -&gt; Bytes 'B Double
forall a b. (a -&gt; b) -&gt; Bytes 'B a -&gt; Bytes 'B b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><span class="hs-identifier hs-var">fromIntegral</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Natural</span></span><span> </span><span class="hs-glyph">@</span><span class="annot"><span class="hs-identifier hs-type">Double</span></span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="annot"><a href="Charon.Runner.html#charonPath"><span class="hs-identifier hs-type">charonPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span>
</span><span id="line-338"></span><span id="charonPath"><span class="annot"><span class="annottext">charonPath :: OsPath
</span><a href="Charon.Runner.html#charonPath"><span class="hs-identifier hs-var hs-var">charonPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[osp|charon|]</span></span><span>
</span><span id="line-339"></span></pre></body></html>