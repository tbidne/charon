<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE QuasiQuotes #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE TemplateHaskell #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Charon.Backend.Default.Utils</span><span>
</span><span id="line-5"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-comment">-- * Trash paths</span></span><span>
</span><span id="line-6"></span><span>    </span><span class="annot"><a href="Charon.Backend.Default.Utils.html#getTrashPathDir"><span class="hs-identifier">getTrashPathDir</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-7"></span><span>    </span><span class="annot"><a href="Charon.Backend.Default.Utils.html#getTrashInfoDir"><span class="hs-identifier">getTrashInfoDir</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-8"></span><span>    </span><span class="annot"><a href="Charon.Backend.Default.Utils.html#getTrashPath"><span class="hs-identifier">getTrashPath</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-9"></span><span>
</span><span id="line-10"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Paths</span></span><span>
</span><span id="line-11"></span><span>    </span><span class="annot"><a href="Charon.Backend.Default.Utils.html#pathFiles"><span class="hs-identifier">pathFiles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-12"></span><span>    </span><span class="annot"><a href="Charon.Backend.Default.Utils.html#pathInfo"><span class="hs-identifier">pathInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Misc</span></span><span>
</span><span id="line-15"></span><span>    </span><span class="annot"><a href="Charon.Backend.Default.Utils.html#getPathInfo"><span class="hs-identifier">getPathInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>    </span><span class="annot"><a href="Charon.Backend.Default.Utils.html#parseTrashInfoMap"><span class="hs-identifier">parseTrashInfoMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>    </span><span class="annot"><a href="Charon.Backend.Default.Utils.html#pathDataToType"><span class="hs-identifier">pathDataToType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>    </span><span class="annot"><a href="Charon.Backend.Default.Utils.html#lookup"><span class="hs-identifier">lookup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Data.PathType.html"><span class="hs-identifier">Charon.Data.PathType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.PathType.html#PathTypeW"><span class="hs-identifier">PathTypeW</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.PathType.html#MkPathTypeW"><span class="hs-identifier">MkPathTypeW</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html"><span class="hs-identifier">Charon.Data.Paths</span></a></span><span>
</span><span id="line-24"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier">PathI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#MkPathI"><span class="hs-identifier">MkPathI</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>    </span><span class="annot"><a href="Charon.Data.Paths.html#PathIndex"><span class="hs-identifier">PathIndex</span></a></span><span>
</span><span id="line-26"></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashDirFiles"><span class="hs-identifier">TrashDirFiles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="Charon.Data.Paths.html#TrashDirInfo"><span class="hs-identifier">TrashDirInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>        </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryFileName"><span class="hs-identifier">TrashEntryFileName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryOriginalPath"><span class="hs-identifier">TrashEntryOriginalPath</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryPath"><span class="hs-identifier">TrashEntryPath</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier">TrashHome</span></a></span><span>
</span><span id="line-32"></span><span>      </span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>    </span><span class="annot"><a href="Charon.Data.Paths.html#%3C%2F%2F%3E"><span class="hs-operator">(&lt;//&gt;)</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html"><span class="hs-identifier">Charon.Data.Paths</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Paths</span></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Exception.html"><span class="hs-identifier">Charon.Exception</span></a></span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Charon.Exception.html#DotsPathE"><span class="hs-identifier">DotsPathE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Exception.html#MkDotsPathE"><span class="hs-identifier">MkDotsPathE</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><a href="Charon.Exception.html#EmptyPathE"><span class="hs-identifier">EmptyPathE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Exception.html#MkEmptyPathE"><span class="hs-identifier">MkEmptyPathE</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span>    </span><span class="annot"><a href="Charon.Exception.html#FileNameEmptyE"><span class="hs-identifier">FileNameEmptyE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Exception.html#MkFileNameEmptyE"><span class="hs-identifier">MkFileNameEmptyE</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>    </span><span class="annot"><a href="Charon.Exception.html#RenameDuplicateE"><span class="hs-identifier">RenameDuplicateE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Exception.html#MkRenameDuplicateE"><span class="hs-identifier">MkRenameDuplicateE</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>    </span><span class="annot"><a href="Charon.Exception.html#RootE"><span class="hs-identifier">RootE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Exception.html#MkRootE"><span class="hs-identifier">MkRootE</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-42"></span><span>    </span><span class="annot"><a href="Charon.Exception.html#UniquePathNotPrefixE"><span class="hs-identifier">UniquePathNotPrefixE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Exception.html#MkUniquePathNotPrefixE"><span class="hs-identifier">MkUniquePathNotPrefixE</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-43"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Prelude.html"><span class="hs-identifier">Charon.Prelude</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Charon.Utils.html"><span class="hs-identifier">Charon.Utils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">U</span></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.ByteString.Char8</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">C8</span></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashMap.Strict.html"><span class="hs-identifier">Data.HashMap.Strict</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashSet.html"><span class="hs-identifier">Data.HashSet</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">L</span></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html"><span class="hs-identifier">Effects.FileSystem.PathReader</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">PR</span></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.Utils.html"><span class="hs-identifier">Effects.FileSystem.Utils</span></a></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FsUtils</span></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">System.OsPath</span></span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FP</span></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="annot"><span class="hs-comment">-- | Retrieves the trash path dir.</span></span><span>
</span><span id="line-55"></span><span class="annot"><a href="Charon.Backend.Default.Utils.html#getTrashPathDir"><span class="hs-identifier hs-type">getTrashPathDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashDirFiles"><span class="hs-identifier hs-type">TrashDirFiles</span></a></span><span>
</span><span id="line-56"></span><span id="getTrashPathDir"><span class="annot"><span class="annottext">getTrashPathDir :: PathI 'TrashHome -&gt; PathI 'TrashDirFiles
</span><a href="Charon.Backend.Default.Utils.html#getTrashPathDir"><span class="hs-identifier hs-var hs-var">getTrashPathDir</span></a></span></span><span> </span><span id="local-6989586621679632107"><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632107"><span class="hs-identifier hs-var">trashHome</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632107"><span class="hs-identifier hs-var">trashHome</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome -&gt; PathI Any -&gt; PathI 'TrashDirFiles
forall (i1 :: PathIndex) (i2 :: PathIndex) (i3 :: PathIndex).
PathI i1 -&gt; PathI i2 -&gt; PathI i3
</span><a href="Charon.Data.Paths.html#%3C%2F%2F%3E"><span class="hs-operator hs-var">&lt;//&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; PathI Any
forall (i :: PathIndex). OsPath -&gt; PathI i
</span><a href="Charon.Data.Paths.html#MkPathI"><span class="hs-identifier hs-var">MkPathI</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="Charon.Backend.Default.Utils.html#pathFiles"><span class="hs-identifier hs-var">pathFiles</span></a></span><span>
</span><span id="line-57"></span><span>
</span><span id="line-58"></span><span class="annot"><span class="hs-comment">-- | Retrieves the trash info dir.</span></span><span>
</span><span id="line-59"></span><span class="annot"><a href="Charon.Backend.Default.Utils.html#getTrashInfoDir"><span class="hs-identifier hs-type">getTrashInfoDir</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashDirInfo"><span class="hs-identifier hs-type">TrashDirInfo</span></a></span><span>
</span><span id="line-60"></span><span id="getTrashInfoDir"><span class="annot"><span class="annottext">getTrashInfoDir :: PathI 'TrashHome -&gt; PathI 'TrashDirInfo
</span><a href="Charon.Backend.Default.Utils.html#getTrashInfoDir"><span class="hs-identifier hs-var hs-var">getTrashInfoDir</span></a></span></span><span> </span><span id="local-6989586621679632108"><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632108"><span class="hs-identifier hs-var">trashHome</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632108"><span class="hs-identifier hs-var">trashHome</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome -&gt; PathI Any -&gt; PathI 'TrashDirInfo
forall (i1 :: PathIndex) (i2 :: PathIndex) (i3 :: PathIndex).
PathI i1 -&gt; PathI i2 -&gt; PathI i3
</span><a href="Charon.Data.Paths.html#%3C%2F%2F%3E"><span class="hs-operator hs-var">&lt;//&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; PathI Any
forall (i :: PathIndex). OsPath -&gt; PathI i
</span><a href="Charon.Data.Paths.html#MkPathI"><span class="hs-identifier hs-var">MkPathI</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="Charon.Backend.Default.Utils.html#pathInfo"><span class="hs-identifier hs-var">pathInfo</span></a></span><span>
</span><span id="line-61"></span><span>
</span><span id="line-62"></span><span class="annot"><a href="Charon.Backend.Default.Utils.html#getTrashPath"><span class="hs-identifier hs-type">getTrashPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryFileName"><span class="hs-identifier hs-type">TrashEntryFileName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryPath"><span class="hs-identifier hs-type">TrashEntryPath</span></a></span><span>
</span><span id="line-63"></span><span id="getTrashPath"><span class="annot"><span class="annottext">getTrashPath :: PathI 'TrashHome
-&gt; PathI 'TrashEntryFileName -&gt; PathI 'TrashEntryPath
</span><a href="Charon.Backend.Default.Utils.html#getTrashPath"><span class="hs-identifier hs-var hs-var">getTrashPath</span></a></span></span><span> </span><span id="local-6989586621679632109"><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632109"><span class="hs-identifier hs-var">trashHome</span></a></span></span><span> </span><span id="local-6989586621679632110"><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632110"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632109"><span class="hs-identifier hs-var">trashHome</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome -&gt; PathI Any -&gt; PathI 'TrashEntryPath
forall (i1 :: PathIndex) (i2 :: PathIndex) (i3 :: PathIndex).
PathI i1 -&gt; PathI i2 -&gt; PathI i3
</span><a href="Charon.Data.Paths.html#%3C%2F%2F%3E"><span class="hs-operator hs-var">&lt;//&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; PathI Any
forall (i :: PathIndex). OsPath -&gt; PathI i
</span><a href="Charon.Data.Paths.html#MkPathI"><span class="hs-identifier hs-var">MkPathI</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="Charon.Backend.Default.Utils.html#pathFiles"><span class="hs-identifier hs-var">pathFiles</span></a></span><span> </span><span class="annot"><span class="annottext">PathI Any -&gt; PathI 'TrashEntryFileName -&gt; PathI Any
forall (i1 :: PathIndex) (i2 :: PathIndex) (i3 :: PathIndex).
PathI i1 -&gt; PathI i2 -&gt; PathI i3
</span><a href="Charon.Data.Paths.html#%3C%2F%2F%3E"><span class="hs-operator hs-var">&lt;//&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632110"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="hs-comment">-- | For a given path, retrieves its unique trash entry file name,</span><span>
</span><span id="line-66"></span><span class="hs-comment">-- original path, and type.</span><span>
</span><span id="line-67"></span><span class="hs-comment">--</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- NOTE: This function is __almost__ backend agnostic. AFAICT the only</span><span>
</span><span id="line-69"></span><span class="hs-comment">-- part that uses internal knowledge is the call to getTrashPath.</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- If we ever write a non-default backend then we should extract that logic</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- to a function and move this fn to Utils, as the rest of the logic is</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- something we will want to use everywhere (e.g. throwIfIllegal).</span><span>
</span><span id="line-73"></span><span id="local-6989586621679631917"><span class="annot"><a href="Charon.Backend.Default.Utils.html#getPathInfo"><span class="hs-identifier hs-type">getPathInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-74"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-75"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679631917"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-76"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#MonadLoggerNS"><span class="hs-identifier hs-type">MonadLoggerNS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679631917"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679631917"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-78"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryOriginalPath"><span class="hs-identifier hs-type">TrashEntryOriginalPath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="#local-6989586621679631917"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryFileName"><span class="hs-identifier hs-type">TrashEntryFileName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryOriginalPath"><span class="hs-identifier hs-type">TrashEntryOriginalPath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Data.PathType.html#PathTypeW"><span class="hs-identifier hs-type">PathTypeW</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-82"></span><span id="getPathInfo"><span class="annot"><span class="annottext">getPathInfo :: forall (m :: * -&gt; *).
(HasCallStack, MonadCatch m, MonadLoggerNS m, MonadPathReader m) =&gt;
PathI 'TrashHome
-&gt; PathI 'TrashEntryOriginalPath
-&gt; m (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
      PathTypeW)
</span><a href="Charon.Backend.Default.Utils.html#getPathInfo"><span class="hs-identifier hs-var hs-var">getPathInfo</span></a></span></span><span> </span><span id="local-6989586621679632157"><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632157"><span class="hs-identifier hs-var">trashHome</span></a></span></span><span> </span><span id="local-6989586621679632158"><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632158"><span class="hs-identifier hs-var">origPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; m (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
      PathTypeW)
-&gt; m (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
      PathTypeW)
forall (m :: * -&gt; *) a. MonadLoggerNS m =&gt; Text -&gt; m a -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#addNamespace"><span class="hs-identifier hs-var">addNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;getPathInfo&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
    PathTypeW)
 -&gt; m (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
       PathTypeW))
-&gt; m (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
      PathTypeW)
-&gt; m (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
      PathTypeW)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6db4xyc3nivqvp6qrbbjc6j03f9zblbr-monad-logger-0.3.40-doc/share/doc/monad-logger-0.3.40/html/src/Control.Monad.Logger.html#logDebug"><span class="hs-identifier hs-type">logDebug</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Retrieving path data: '&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath -&gt; Text
forall (i :: PathIndex). PathI i -&gt; Text
</span><a href="Charon.Data.Paths.html#toText"><span class="hs-identifier hs-var">Paths.toText</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632158"><span class="hs-identifier hs-var">origPath</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'&quot;</span></span><span>
</span><span id="line-84"></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-comment">-- It is VERY important that this check is first i.e. we perform it</span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-comment">-- on the original given path, before any processing. As an example of</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-comment">-- what can go wrong, if someone attempts to delete a blank path</span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-comment">-- (i.e. charon d &quot;&quot;), then canonicalizePath will turn this into the current</span><span>
</span><span id="line-89"></span><span>  </span><span class="hs-comment">-- directory, as in, will delete the entire working directory. This is</span><span>
</span><span id="line-90"></span><span>  </span><span class="hs-comment">-- not what we want!</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath -&gt; m ()
forall (m :: * -&gt; *).
(HasCallStack, MonadLoggerNS m, MonadThrow m) =&gt;
PathI 'TrashEntryOriginalPath -&gt; m ()
</span><a href="Charon.Backend.Default.Utils.html#throwIfIllegal"><span class="hs-identifier hs-var">throwIfIllegal</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632158"><span class="hs-identifier hs-var">origPath</span></a></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621679632169"><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632169"><span class="hs-identifier hs-var">origAbsolute</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679632170"><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632170"><span class="hs-identifier hs-var">fileName</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
-&gt; m (PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName)
forall (m :: * -&gt; *).
(HasCallStack, MonadLoggerNS m, MonadPathReader m, MonadThrow m) =&gt;
PathI 'TrashEntryOriginalPath
-&gt; m (PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName)
</span><a href="Charon.Backend.Default.Utils.html#mkAbsoluteAndGetName"><span class="hs-identifier hs-var">mkAbsoluteAndGetName</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632158"><span class="hs-identifier hs-var">origPath</span></a></span><span>
</span><span id="line-94"></span><span>
</span><span id="line-95"></span><span>  </span><span id="local-6989586621679632172"><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632172"><span class="hs-identifier hs-var">uniqName</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome
-&gt; PathI 'TrashEntryFileName -&gt; m (PathI 'TrashEntryFileName)
forall (m :: * -&gt; *).
(HasCallStack, MonadLoggerNS m, MonadPathReader m, MonadThrow m) =&gt;
PathI 'TrashHome
-&gt; PathI 'TrashEntryFileName -&gt; m (PathI 'TrashEntryFileName)
</span><a href="Charon.Backend.Default.Utils.html#mkUniqName"><span class="hs-identifier hs-var">mkUniqName</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632157"><span class="hs-identifier hs-var">trashHome</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632170"><span class="hs-identifier hs-var">fileName</span></a></span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>  </span><span class="hs-comment">-- see NOTE: [getPathType]</span><span>
</span><span id="line-98"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632172"><span class="hs-identifier hs-var">uniqName</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632169"><span class="hs-identifier hs-var">origAbsolute</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>    </span><span class="annot"><span class="annottext">(PathTypeW
 -&gt; (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
     PathTypeW))
-&gt; (PathType -&gt; PathTypeW)
-&gt; PathType
-&gt; (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
    PathTypeW)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">PathType -&gt; PathTypeW
</span><a href="Charon.Data.PathType.html#MkPathTypeW"><span class="hs-identifier hs-var">MkPathTypeW</span></a></span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><span class="annottext">(PathType
 -&gt; (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
     PathTypeW))
-&gt; m PathType
-&gt; m (PathI 'TrashEntryFileName, PathI 'TrashEntryOriginalPath,
      PathTypeW)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">(HasCallStack =&gt; OsPath -&gt; m PathType)
-&gt; PathI 'TrashEntryOriginalPath -&gt; m PathType
forall a (i :: PathIndex).
HasCallStack =&gt;
(HasCallStack =&gt; OsPath -&gt; a) -&gt; PathI i -&gt; a
</span><a href="Charon.Data.Paths.html#applyPathI"><span class="hs-identifier hs-var">Paths.applyPathI</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; OsPath -&gt; m PathType
OsPath -&gt; m PathType
forall (m :: * -&gt; *).
(HasCallStack, MonadCatch m, MonadPathReader m) =&gt;
OsPath -&gt; m PathType
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#getPathType"><span class="hs-identifier hs-var">PR.getPathType</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632169"><span class="hs-identifier hs-var">origAbsolute</span></a></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span id="local-6989586621679631950"><span class="annot"><a href="Charon.Backend.Default.Utils.html#mkAbsoluteAndGetName"><span class="hs-identifier hs-type">mkAbsoluteAndGetName</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#MonadLoggerNS"><span class="hs-identifier hs-type">MonadLoggerNS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679631950"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679631950"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679631950"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryOriginalPath"><span class="hs-identifier hs-type">TrashEntryOriginalPath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><a href="#local-6989586621679631950"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryOriginalPath"><span class="hs-identifier hs-type">TrashEntryOriginalPath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryFileName"><span class="hs-identifier hs-type">TrashEntryFileName</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-110"></span><span id="mkAbsoluteAndGetName"><span class="annot"><span class="annottext">mkAbsoluteAndGetName :: forall (m :: * -&gt; *).
(HasCallStack, MonadLoggerNS m, MonadPathReader m, MonadThrow m) =&gt;
PathI 'TrashEntryOriginalPath
-&gt; m (PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName)
</span><a href="Charon.Backend.Default.Utils.html#mkAbsoluteAndGetName"><span class="hs-identifier hs-var hs-var">mkAbsoluteAndGetName</span></a></span></span><span> </span><span id="local-6989586621679632223"><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632223"><span class="hs-identifier hs-var">origPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; m (PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName)
-&gt; m (PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName)
forall (m :: * -&gt; *) a. MonadLoggerNS m =&gt; Text -&gt; m a -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#addNamespace"><span class="hs-identifier hs-var">addNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;mkAbsoluteAndGetName&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName)
 -&gt; m (PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName))
-&gt; m (PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName)
-&gt; m (PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-111"></span><span>  </span><span class="hs-comment">-- Previously we used canonicalizePath instead of makeAbsolute.</span><span>
</span><span id="line-112"></span><span>  </span><span class="hs-comment">-- This had the problem of turning symlinks into their targets, which</span><span>
</span><span id="line-113"></span><span>  </span><span class="hs-comment">-- is not what we want. makeAbsolute seems to do what we want.</span><span>
</span><span id="line-114"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-comment">-- Note that we now have to manually call dropTrailingPathSeparator.</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-comment">-- Previously this was part of canonicalizePath.</span><span>
</span><span id="line-117"></span><span>  </span><span id="local-6989586621679632224"><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632224"><span class="hs-identifier hs-var">origAbsolute</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack =&gt; OsPath -&gt; m OsPath)
-&gt; PathI 'TrashEntryOriginalPath
-&gt; m (PathI 'TrashEntryOriginalPath)
forall (f :: * -&gt; *) (i :: PathIndex).
Functor f =&gt;
(HasCallStack =&gt; OsPath -&gt; f OsPath) -&gt; PathI i -&gt; f (PathI i)
</span><a href="Charon.Data.Paths.html#liftPathIF%27"><span class="hs-identifier hs-var">Paths.liftPathIF'</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; OsPath -&gt; m OsPath
OsPath -&gt; m OsPath
forall (m :: * -&gt; *).
(MonadPathReader m, HasCallStack) =&gt;
OsPath -&gt; m OsPath
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#makeAbsolute"><span class="hs-identifier hs-var">PR.makeAbsolute</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632223"><span class="hs-identifier hs-var">origPath</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6db4xyc3nivqvp6qrbbjc6j03f9zblbr-monad-logger-0.3.40-doc/share/doc/monad-logger-0.3.40/html/src/Control.Monad.Logger.html#logDebug"><span class="hs-identifier hs-type">logDebug</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Absolute: '&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath -&gt; Text
forall (i :: PathIndex). PathI i -&gt; Text
</span><a href="Charon.Data.Paths.html#toText"><span class="hs-identifier hs-var">Paths.toText</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632224"><span class="hs-identifier hs-var">origAbsolute</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'&quot;</span></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span>  </span><span class="hs-comment">-- Have to dropTrailingPathSeparator here because a trailing slash will</span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-comment">-- make takeFileName give us the wrong path. We also need this so that</span><span>
</span><span id="line-122"></span><span>  </span><span class="hs-comment">-- later lookups succeed (requires string equality)</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679632231"><span class="annot"><span class="annottext">origAbsoluteNoSlash :: PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632231"><span class="hs-identifier hs-var hs-var">origAbsoluteNoSlash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; OsPath)
-&gt; PathI 'TrashEntryOriginalPath -&gt; PathI 'TrashEntryOriginalPath
forall (i :: PathIndex). (OsPath -&gt; OsPath) -&gt; PathI i -&gt; PathI i
</span><a href="Charon.Data.Paths.html#liftPathI%27"><span class="hs-identifier hs-var">Paths.liftPathI'</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; OsPath
</span><span class="hs-identifier hs-var">FP.dropTrailingPathSeparator</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632224"><span class="hs-identifier hs-var">origAbsolute</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>  </span><span class="hs-comment">-- Need to get the file name here because fp could refer to an</span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-comment">-- absolute path. In this case, &lt;/&gt; returns the 2nd arg which is absolutely</span><span>
</span><span id="line-127"></span><span>  </span><span class="hs-comment">-- not what we want.</span><span>
</span><span id="line-128"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621679632234"><span class="hs-identifier hs-type">fileName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryFileName"><span class="hs-identifier hs-type">TrashEntryFileName</span></a></span><span>
</span><span id="line-129"></span><span>      </span><span id="local-6989586621679632234"><span class="annot"><span class="annottext">fileName :: PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632234"><span class="hs-identifier hs-var hs-var">fileName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; OsPath)
-&gt; PathI 'TrashEntryOriginalPath -&gt; PathI 'TrashEntryFileName
forall (i :: PathIndex) (j :: PathIndex).
(OsPath -&gt; OsPath) -&gt; PathI i -&gt; PathI j
</span><a href="Charon.Data.Paths.html#liftPathI"><span class="hs-identifier hs-var">Paths.liftPathI</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; OsPath
</span><span class="hs-identifier hs-var">FP.takeFileName</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632231"><span class="hs-identifier hs-var">origAbsoluteNoSlash</span></a></span><span>
</span><span id="line-130"></span><span>  </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6db4xyc3nivqvp6qrbbjc6j03f9zblbr-monad-logger-0.3.40-doc/share/doc/monad-logger-0.3.40/html/src/Control.Monad.Logger.html#logDebug"><span class="hs-identifier hs-type">logDebug</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;File name: '&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName -&gt; Text
forall (i :: PathIndex). PathI i -&gt; Text
</span><a href="Charon.Data.Paths.html#toText"><span class="hs-identifier hs-var">Paths.toText</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632234"><span class="hs-identifier hs-var">fileName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'&quot;</span></span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-comment">-- Paranoia check for previous bug: check that derived name is not empty.</span><span>
</span><span id="line-133"></span><span>  </span><span id="local-6989586621679632237"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679632237"><span class="hs-identifier hs-var">isEmpty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack =&gt; OsPath -&gt; m Bool)
-&gt; PathI 'TrashEntryFileName -&gt; m Bool
forall a (i :: PathIndex).
HasCallStack =&gt;
(HasCallStack =&gt; OsPath -&gt; a) -&gt; PathI i -&gt; a
</span><a href="Charon.Data.Paths.html#applyPathI"><span class="hs-identifier hs-var">Paths.applyPathI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; m String -&gt; m Bool
forall a b. (a -&gt; b) -&gt; m a -&gt; m b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><span class="hs-identifier hs-var">null</span></span><span> </span><span class="annot"><span class="annottext">(m String -&gt; m Bool) -&gt; (OsPath -&gt; m String) -&gt; OsPath -&gt; m Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; m String
forall (m :: * -&gt; *).
(HasCallStack, MonadThrow m) =&gt;
OsPath -&gt; m String
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.Utils.html#decodeOsToFpThrowM"><span class="hs-identifier hs-var">decodeOsToFpThrowM</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632234"><span class="hs-identifier hs-var">fileName</span></a></span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">when</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679632237"><span class="hs-identifier hs-var">isEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>    </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6db4xyc3nivqvp6qrbbjc6j03f9zblbr-monad-logger-0.3.40-doc/share/doc/monad-logger-0.3.40/html/src/Control.Monad.Logger.html#logError"><span class="hs-identifier hs-type">logError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Decoded filename is empty&quot;</span></span><span>
</span><span id="line-136"></span><span>    </span><span class="annot"><span class="annottext">FileNameEmptyE -&gt; m ()
forall (m :: * -&gt; *) e a.
(Exception e, HasCallStack, MonadThrow m) =&gt;
e -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-exceptions-0.1-cbc6c6992b43b60e49e859c21827717f4c8f4d9ff6ce5ae6d908553d0e8694a2/share/doc/html/src/Effects.Exception.html#throwCS"><span class="hs-identifier hs-var">throwCS</span></a></span><span> </span><span class="annot"><span class="annottext">(FileNameEmptyE -&gt; m ()) -&gt; FileNameEmptyE -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath -&gt; FileNameEmptyE
</span><a href="Charon.Exception.html#MkFileNameEmptyE"><span class="hs-identifier hs-var">MkFileNameEmptyE</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632223"><span class="hs-identifier hs-var">origPath</span></a></span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><span class="annottext">(PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName)
-&gt; m (PathI 'TrashEntryOriginalPath, PathI 'TrashEntryFileName)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632231"><span class="hs-identifier hs-var">origAbsoluteNoSlash</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632234"><span class="hs-identifier hs-var">fileName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span id="local-6989586621679631951"><span class="annot"><a href="Charon.Backend.Default.Utils.html#mkUniqName"><span class="hs-identifier hs-type">mkUniqName</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-142"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#MonadLoggerNS"><span class="hs-identifier hs-type">MonadLoggerNS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679631951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-143"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679631951"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-144"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679631951"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-146"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-147"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryFileName"><span class="hs-identifier hs-type">TrashEntryFileName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-148"></span><span>  </span><span class="annot"><a href="#local-6989586621679631951"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryFileName"><span class="hs-identifier hs-type">TrashEntryFileName</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-149"></span><span id="mkUniqName"><span class="annot"><span class="annottext">mkUniqName :: forall (m :: * -&gt; *).
(HasCallStack, MonadLoggerNS m, MonadPathReader m, MonadThrow m) =&gt;
PathI 'TrashHome
-&gt; PathI 'TrashEntryFileName -&gt; m (PathI 'TrashEntryFileName)
</span><a href="Charon.Backend.Default.Utils.html#mkUniqName"><span class="hs-identifier hs-var hs-var">mkUniqName</span></a></span></span><span> </span><span id="local-6989586621679632284"><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632284"><span class="hs-identifier hs-var">trashHome</span></a></span></span><span> </span><span id="local-6989586621679632285"><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632285"><span class="hs-identifier hs-var">fileName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text
-&gt; m (PathI 'TrashEntryFileName) -&gt; m (PathI 'TrashEntryFileName)
forall (m :: * -&gt; *) a. MonadLoggerNS m =&gt; Text -&gt; m a -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#addNamespace"><span class="hs-identifier hs-var">addNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;getUniqueName&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m (PathI 'TrashEntryFileName) -&gt; m (PathI 'TrashEntryFileName))
-&gt; m (PathI 'TrashEntryFileName) -&gt; m (PathI 'TrashEntryFileName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-150"></span><span>  </span><span id="local-6989586621679632286"><span class="annot"><span class="annottext">PathI 'TrashEntryPath
</span><a href="#local-6989586621679632286"><span class="hs-identifier hs-var">uniqPath</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath -&gt; m (PathI 'TrashEntryPath)
forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m, MonadThrow m) =&gt;
PathI 'TrashEntryPath -&gt; m (PathI 'TrashEntryPath)
</span><a href="Charon.Backend.Default.Utils.html#mkUniqPath"><span class="hs-identifier hs-var">mkUniqPath</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathI 'TrashHome
-&gt; PathI 'TrashEntryFileName -&gt; PathI 'TrashEntryPath
</span><a href="Charon.Backend.Default.Utils.html#getTrashPath"><span class="hs-identifier hs-var">getTrashPath</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632284"><span class="hs-identifier hs-var">trashHome</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632285"><span class="hs-identifier hs-var">fileName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>  </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6db4xyc3nivqvp6qrbbjc6j03f9zblbr-monad-logger-0.3.40-doc/share/doc/monad-logger-0.3.40/html/src/Control.Monad.Logger.html#logDebug"><span class="hs-identifier hs-type">logDebug</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Unique path: '&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath -&gt; Text
forall (i :: PathIndex). PathI i -&gt; Text
</span><a href="Charon.Data.Paths.html#toText"><span class="hs-identifier hs-var">Paths.toText</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath
</span><a href="#local-6989586621679632286"><span class="hs-identifier hs-var">uniqPath</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'&quot;</span></span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679632288"><span class="annot"><span class="annottext">uniqName :: PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632288"><span class="hs-identifier hs-var hs-var">uniqName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; OsPath)
-&gt; PathI 'TrashEntryPath -&gt; PathI 'TrashEntryFileName
forall (i :: PathIndex) (j :: PathIndex).
(OsPath -&gt; OsPath) -&gt; PathI i -&gt; PathI j
</span><a href="Charon.Data.Paths.html#liftPathI"><span class="hs-identifier hs-var">Paths.liftPathI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OsPath -&gt; OsPath
</span><span class="hs-identifier hs-var">FP.takeFileName</span></span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; OsPath) -&gt; (OsPath -&gt; OsPath) -&gt; OsPath -&gt; OsPath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; OsPath
</span><span class="hs-identifier hs-var">FP.dropTrailingPathSeparator</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath
</span><a href="#local-6989586621679632286"><span class="hs-identifier hs-var">uniqPath</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6db4xyc3nivqvp6qrbbjc6j03f9zblbr-monad-logger-0.3.40-doc/share/doc/monad-logger-0.3.40/html/src/Control.Monad.Logger.html#logDebug"><span class="hs-identifier hs-type">logDebug</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Text -&gt; m ()) -&gt; Text -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Unique name: '&quot;</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName -&gt; Text
forall (i :: PathIndex). PathI i -&gt; Text
</span><a href="Charon.Data.Paths.html#toText"><span class="hs-identifier hs-var">Paths.toText</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632288"><span class="hs-identifier hs-var">uniqName</span></a></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Text -&gt; Text
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;'&quot;</span></span><span>
</span><span id="line-155"></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-comment">-- Paranoia check for previous bug: check that derived unique name is suffix</span><span>
</span><span id="line-157"></span><span>  </span><span class="hs-comment">-- of the original name (e.g. foo -&gt; foo (1)).</span><span>
</span><span id="line-158"></span><span>  </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName -&gt; PathI 'TrashEntryFileName -&gt; m ()
forall (m :: * -&gt; *).
(HasCallStack, MonadThrow m) =&gt;
PathI 'TrashEntryFileName -&gt; PathI 'TrashEntryFileName -&gt; m ()
</span><a href="Charon.Backend.Default.Utils.html#throwIfNotPrefix"><span class="hs-identifier hs-var">throwIfNotPrefix</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632285"><span class="hs-identifier hs-var">fileName</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632288"><span class="hs-identifier hs-var">uniqName</span></a></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span>  </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName -&gt; m (PathI 'TrashEntryFileName)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632288"><span class="hs-identifier hs-var">uniqName</span></a></span><span>
</span><span id="line-161"></span><span>
</span><span id="line-162"></span><span class="hs-comment">-- | Ensures the filepath @p@ is unique. If @p@ collides with another path,</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- we iteratively try appending numbers, stopping once we find a unique path.</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- For example, for duplicate &quot;file&quot;, we will try</span><span>
</span><span id="line-165"></span><span class="hs-comment">--</span><span>
</span><span id="line-166"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- &quot;file (1)&quot;, &quot;file (2)&quot;, &quot;file (3)&quot;, ...</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-169"></span><span class="annot"><a href="Charon.Backend.Default.Utils.html#mkUniqPath"><span class="hs-identifier hs-type">mkUniqPath</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-170"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679631979"><span class="annot"><a href="#local-6989586621679631979"><span class="hs-identifier hs-type">m</span></a></span></span><span class="hs-operator">.</span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-172"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679631979"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-173"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679631979"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-174"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-175"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryPath"><span class="hs-identifier hs-type">TrashEntryPath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-176"></span><span>  </span><span class="annot"><a href="#local-6989586621679631979"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryPath"><span class="hs-identifier hs-type">TrashEntryPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span id="mkUniqPath"><span class="annot"><span class="annottext">mkUniqPath :: forall (m :: * -&gt; *).
(HasCallStack, MonadPathReader m, MonadThrow m) =&gt;
PathI 'TrashEntryPath -&gt; m (PathI 'TrashEntryPath)
</span><a href="Charon.Backend.Default.Utils.html#mkUniqPath"><span class="hs-identifier hs-var hs-var">mkUniqPath</span></a></span></span><span> </span><span id="local-6989586621679632303"><span class="annot"><span class="annottext">PathI 'TrashEntryPath
</span><a href="#local-6989586621679632303"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-178"></span><span>  </span><span id="local-6989586621679632304"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679632304"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack =&gt; OsPath -&gt; m Bool)
-&gt; PathI 'TrashEntryPath -&gt; m Bool
forall a (i :: PathIndex).
HasCallStack =&gt;
(HasCallStack =&gt; OsPath -&gt; a) -&gt; PathI i -&gt; a
</span><a href="Charon.Data.Paths.html#applyPathI"><span class="hs-identifier hs-var">Paths.applyPathI</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; OsPath -&gt; m Bool
OsPath -&gt; m Bool
forall (m :: * -&gt; *).
(MonadPathReader m, HasCallStack) =&gt;
OsPath -&gt; m Bool
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#doesPathExist"><span class="hs-identifier hs-var">doesPathExist</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath
</span><a href="#local-6989586621679632303"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-179"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679632304"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Word16 -&gt; m (PathI 'TrashEntryPath)
Word16 -&gt; m (PathI 'TrashEntryPath)
</span><a href="#local-6989586621679632310"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span>
</span><span id="line-181"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath -&gt; m (PathI 'TrashEntryPath)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath
</span><a href="#local-6989586621679632303"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-182"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><a href="#local-6989586621679632310"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Word16</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679631979"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryPath"><span class="hs-identifier hs-type">TrashEntryPath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>    </span><span id="local-6989586621679632310"><span class="annot"><span class="annottext">go :: HasCallStack =&gt; Word16 -&gt; m (PathI 'TrashEntryPath)
</span><a href="#local-6989586621679632310"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621679632335"><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679632335"><span class="hs-identifier hs-var">counter</span></a></span></span><span>
</span><span id="line-185"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679632335"><span class="hs-identifier hs-var">counter</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Word16
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-186"></span><span>          </span><span class="annot"><span class="annottext">RenameDuplicateE -&gt; m (PathI 'TrashEntryPath)
forall (m :: * -&gt; *) e a.
(Exception e, HasCallStack, MonadThrow m) =&gt;
e -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-exceptions-0.1-cbc6c6992b43b60e49e859c21827717f4c8f4d9ff6ce5ae6d908553d0e8694a2/share/doc/html/src/Effects.Exception.html#throwCS"><span class="hs-identifier hs-var">throwCS</span></a></span><span> </span><span class="annot"><span class="annottext">(RenameDuplicateE -&gt; m (PathI 'TrashEntryPath))
-&gt; RenameDuplicateE -&gt; m (PathI 'TrashEntryPath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath -&gt; RenameDuplicateE
</span><a href="Charon.Exception.html#MkRenameDuplicateE"><span class="hs-identifier hs-var">MkRenameDuplicateE</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath
</span><a href="#local-6989586621679632303"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-187"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-188"></span><span>          </span><span id="local-6989586621679632337"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679632337"><span class="hs-identifier hs-var">counterStr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; m OsPath
forall {m :: * -&gt; *} {a}. (MonadThrow m, Show a) =&gt; a -&gt; m OsPath
</span><a href="#local-6989586621679632338"><span class="hs-identifier hs-var">mkSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679632335"><span class="hs-identifier hs-var">counter</span></a></span><span>
</span><span id="line-189"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679632339"><span class="annot"><span class="annottext">fp' :: PathI 'TrashEntryPath
</span><a href="#local-6989586621679632339"><span class="hs-identifier hs-var hs-var">fp'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(OsPath -&gt; OsPath)
-&gt; PathI 'TrashEntryPath -&gt; PathI 'TrashEntryPath
forall (i :: PathIndex). (OsPath -&gt; OsPath) -&gt; PathI i -&gt; PathI i
</span><a href="Charon.Data.Paths.html#liftPathI%27"><span class="hs-identifier hs-var">Paths.liftPathI'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OsPath -&gt; OsPath -&gt; OsPath
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679632337"><span class="hs-identifier hs-var">counterStr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath
</span><a href="#local-6989586621679632303"><span class="hs-identifier hs-var">fp</span></a></span><span>
</span><span id="line-190"></span><span>          </span><span id="local-6989586621679632340"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679632340"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack =&gt; OsPath -&gt; m Bool)
-&gt; PathI 'TrashEntryPath -&gt; m Bool
forall a (i :: PathIndex).
HasCallStack =&gt;
(HasCallStack =&gt; OsPath -&gt; a) -&gt; PathI i -&gt; a
</span><a href="Charon.Data.Paths.html#applyPathI"><span class="hs-identifier hs-var">Paths.applyPathI</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; OsPath -&gt; m Bool
OsPath -&gt; m Bool
forall (m :: * -&gt; *).
(MonadPathReader m, HasCallStack) =&gt;
OsPath -&gt; m Bool
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#doesPathExist"><span class="hs-identifier hs-var">doesPathExist</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath
</span><a href="#local-6989586621679632339"><span class="hs-identifier hs-var">fp'</span></a></span><span>
</span><span id="line-191"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621679632340"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-192"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Word16 -&gt; m (PathI 'TrashEntryPath)
Word16 -&gt; m (PathI 'TrashEntryPath)
</span><a href="#local-6989586621679632310"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Word16
</span><a href="#local-6989586621679632335"><span class="hs-identifier hs-var">counter</span></a></span><span> </span><span class="annot"><span class="annottext">Word16 -&gt; Word16 -&gt; Word16
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">+</span></span><span> </span><span class="annot"><span class="annottext">Word16
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-193"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath -&gt; m (PathI 'TrashEntryPath)
forall a. a -&gt; m a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryPath
</span><a href="#local-6989586621679632339"><span class="hs-identifier hs-var">fp'</span></a></span><span>
</span><span id="line-194"></span><span>    </span><span id="local-6989586621679632338"><span class="annot"><span class="annottext">mkSuffix :: a -&gt; m OsPath
</span><a href="#local-6989586621679632338"><span class="hs-identifier hs-var hs-var">mkSuffix</span></a></span></span><span> </span><span id="local-6989586621679632364"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679632364"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; m OsPath
forall (m :: * -&gt; *).
(HasCallStack, MonadThrow m) =&gt;
String -&gt; m OsPath
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.Utils.html#encodeFpToOsThrowM"><span class="hs-identifier hs-var">FsUtils.encodeFpToOsThrowM</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; m OsPath) -&gt; String -&gt; m OsPath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; (&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><span class="hs-identifier hs-var">show</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679632364"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span id="local-6989586621679631980"><span class="annot"><a href="Charon.Backend.Default.Utils.html#throwIfNotPrefix"><span class="hs-identifier hs-type">throwIfNotPrefix</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-197"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679631980"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-200"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryFileName"><span class="hs-identifier hs-type">TrashEntryFileName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-201"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryFileName"><span class="hs-identifier hs-type">TrashEntryFileName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-202"></span><span>  </span><span class="annot"><a href="#local-6989586621679631980"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-203"></span><span id="throwIfNotPrefix"><span class="annot"><span class="annottext">throwIfNotPrefix :: forall (m :: * -&gt; *).
(HasCallStack, MonadThrow m) =&gt;
PathI 'TrashEntryFileName -&gt; PathI 'TrashEntryFileName -&gt; m ()
</span><a href="Charon.Backend.Default.Utils.html#throwIfNotPrefix"><span class="hs-identifier hs-var hs-var">throwIfNotPrefix</span></a></span></span><span> </span><span id="local-6989586621679632385"><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632385"><span class="hs-identifier hs-var">origName</span></a></span></span><span> </span><span id="local-6989586621679632386"><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632386"><span class="hs-identifier hs-var">newName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>  </span><span id="local-6989586621679632387"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679632387"><span class="hs-identifier hs-var">origNameStr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack =&gt; OsPath -&gt; m String)
-&gt; PathI 'TrashEntryFileName -&gt; m String
forall a (i :: PathIndex).
HasCallStack =&gt;
(HasCallStack =&gt; OsPath -&gt; a) -&gt; PathI i -&gt; a
</span><a href="Charon.Data.Paths.html#applyPathI"><span class="hs-identifier hs-var">Paths.applyPathI</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; OsPath -&gt; m String
OsPath -&gt; m String
forall (m :: * -&gt; *).
(HasCallStack, MonadThrow m) =&gt;
OsPath -&gt; m String
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.Utils.html#decodeOsToFpThrowM"><span class="hs-identifier hs-var">decodeOsToFpThrowM</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632385"><span class="hs-identifier hs-var">origName</span></a></span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621679632392"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679632392"><span class="hs-identifier hs-var">newNameStr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HasCallStack =&gt; OsPath -&gt; m String)
-&gt; PathI 'TrashEntryFileName -&gt; m String
forall a (i :: PathIndex).
HasCallStack =&gt;
(HasCallStack =&gt; OsPath -&gt; a) -&gt; PathI i -&gt; a
</span><a href="Charon.Data.Paths.html#applyPathI"><span class="hs-identifier hs-var">Paths.applyPathI</span></a></span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; OsPath -&gt; m String
OsPath -&gt; m String
forall (m :: * -&gt; *).
(HasCallStack, MonadThrow m) =&gt;
OsPath -&gt; m String
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.Utils.html#decodeOsToFpThrowM"><span class="hs-identifier hs-var">decodeOsToFpThrowM</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632386"><span class="hs-identifier hs-var">newName</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span>
</span><span id="line-208"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679632387"><span class="hs-identifier hs-var">origNameStr</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><span class="hs-operator hs-var">`L.isPrefixOf`</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621679632392"><span class="hs-identifier hs-var">newNameStr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-209"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniquePathNotPrefixE -&gt; m ()
forall (m :: * -&gt; *) e a.
(Exception e, HasCallStack, MonadThrow m) =&gt;
e -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-exceptions-0.1-cbc6c6992b43b60e49e859c21827717f4c8f4d9ff6ce5ae6d908553d0e8694a2/share/doc/html/src/Effects.Exception.html#throwCS"><span class="hs-identifier hs-var">throwCS</span></a></span><span> </span><span class="annot"><span class="annottext">(UniquePathNotPrefixE -&gt; m ()) -&gt; UniquePathNotPrefixE -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
-&gt; PathI 'TrashEntryFileName -&gt; UniquePathNotPrefixE
</span><a href="Charon.Exception.html#MkUniquePathNotPrefixE"><span class="hs-identifier hs-var">MkUniquePathNotPrefixE</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632385"><span class="hs-identifier hs-var">origName</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryFileName
</span><a href="#local-6989586621679632386"><span class="hs-identifier hs-var">newName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span id="local-6989586621679631949"><span class="annot"><a href="Charon.Backend.Default.Utils.html#throwIfIllegal"><span class="hs-identifier hs-type">throwIfIllegal</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-212"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-213"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#MonadLoggerNS"><span class="hs-identifier hs-type">MonadLoggerNS</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679631949"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-214"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadThrow</span></span><span> </span><span class="annot"><a href="#local-6989586621679631949"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-216"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryOriginalPath"><span class="hs-identifier hs-type">TrashEntryOriginalPath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-217"></span><span>  </span><span class="annot"><a href="#local-6989586621679631949"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-218"></span><span id="throwIfIllegal"><span class="annot"><span class="annottext">throwIfIllegal :: forall (m :: * -&gt; *).
(HasCallStack, MonadLoggerNS m, MonadThrow m) =&gt;
PathI 'TrashEntryOriginalPath -&gt; m ()
</span><a href="Charon.Backend.Default.Utils.html#throwIfIllegal"><span class="hs-identifier hs-var hs-var">throwIfIllegal</span></a></span></span><span> </span><span id="local-6989586621679632442"><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632442"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Text -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a. MonadLoggerNS m =&gt; Text -&gt; m a -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-logger-ns-0.1-b96c319398a670dedadb6001e467621e4edfb4802f21815370b7c61f112e9121/share/doc/html/src/Effects.LoggerNS.html#addNamespace"><span class="hs-identifier hs-var">addNamespace</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;throwIfIllegal&quot;</span></span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-219"></span><span>  </span><span class="annot"><span class="annottext">m Bool -&gt; m () -&gt; m ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Charon.Utils.html#whenM"><span class="hs-identifier hs-var">U.whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath -&gt; m Bool
forall (m :: * -&gt; *) (i :: PathIndex).
MonadThrow m =&gt;
PathI i -&gt; m Bool
</span><a href="Charon.Data.Paths.html#isRoot"><span class="hs-identifier hs-var">Paths.isRoot</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632442"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6db4xyc3nivqvp6qrbbjc6j03f9zblbr-monad-logger-0.3.40-doc/share/doc/monad-logger-0.3.40/html/src/Control.Monad.Logger.html#logError"><span class="hs-identifier hs-type">logError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Path is root!&quot;</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall a b. m a -&gt; m b -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">RootE -&gt; m ()
forall (m :: * -&gt; *) e a.
(Exception e, HasCallStack, MonadThrow m) =&gt;
e -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-exceptions-0.1-cbc6c6992b43b60e49e859c21827717f4c8f4d9ff6ce5ae6d908553d0e8694a2/share/doc/html/src/Effects.Exception.html#throwCS"><span class="hs-identifier hs-var">throwCS</span></a></span><span> </span><span class="annot"><span class="annottext">RootE
</span><a href="Charon.Exception.html#MkRootE"><span class="hs-identifier hs-var">MkRootE</span></a></span><span>
</span><span id="line-220"></span><span>  </span><span class="annot"><span class="annottext">m Bool -&gt; m () -&gt; m ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Charon.Utils.html#whenM"><span class="hs-identifier hs-var">U.whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath -&gt; m Bool
forall (m :: * -&gt; *) (i :: PathIndex).
MonadThrow m =&gt;
PathI i -&gt; m Bool
</span><a href="Charon.Data.Paths.html#isEmpty"><span class="hs-identifier hs-var">Paths.isEmpty</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632442"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6db4xyc3nivqvp6qrbbjc6j03f9zblbr-monad-logger-0.3.40-doc/share/doc/monad-logger-0.3.40/html/src/Control.Monad.Logger.html#logError"><span class="hs-identifier hs-type">logError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Path is empty!&quot;</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall a b. m a -&gt; m b -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">EmptyPathE -&gt; m ()
forall (m :: * -&gt; *) e a.
(Exception e, HasCallStack, MonadThrow m) =&gt;
e -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-exceptions-0.1-cbc6c6992b43b60e49e859c21827717f4c8f4d9ff6ce5ae6d908553d0e8694a2/share/doc/html/src/Effects.Exception.html#throwCS"><span class="hs-identifier hs-var">throwCS</span></a></span><span> </span><span class="annot"><span class="annottext">EmptyPathE
</span><a href="Charon.Exception.html#MkEmptyPathE"><span class="hs-identifier hs-var">MkEmptyPathE</span></a></span><span>
</span><span id="line-221"></span><span>  </span><span class="annot"><span class="annottext">m Bool -&gt; m () -&gt; m ()
forall (m :: * -&gt; *). Monad m =&gt; m Bool -&gt; m () -&gt; m ()
</span><a href="Charon.Utils.html#whenM"><span class="hs-identifier hs-var">U.whenM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath -&gt; m Bool
forall (m :: * -&gt; *) (i :: PathIndex).
MonadThrow m =&gt;
PathI i -&gt; m Bool
</span><a href="Charon.Data.Paths.html#isDots"><span class="hs-identifier hs-var">Paths.isDots</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632442"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-special">$</span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/6db4xyc3nivqvp6qrbbjc6j03f9zblbr-monad-logger-0.3.40-doc/share/doc/monad-logger-0.3.40/html/src/Control.Monad.Logger.html#logError"><span class="hs-identifier hs-type">logError</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Path is dots!&quot;</span></span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall a b. m a -&gt; m b -&gt; m b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span><span class="hs-operator hs-var">*&gt;</span></span><span> </span><span class="annot"><span class="annottext">DotsPathE -&gt; m ()
forall (m :: * -&gt; *) e a.
(Exception e, HasCallStack, MonadThrow m) =&gt;
e -&gt; m a
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-exceptions-0.1-cbc6c6992b43b60e49e859c21827717f4c8f4d9ff6ce5ae6d908553d0e8694a2/share/doc/html/src/Effects.Exception.html#throwCS"><span class="hs-identifier hs-var">throwCS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath -&gt; DotsPathE
</span><a href="Charon.Exception.html#MkDotsPathE"><span class="hs-identifier hs-var">MkDotsPathE</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashEntryOriginalPath
</span><a href="#local-6989586621679632442"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span class="hs-comment">-- | Parses a ByteString like:</span><span>
</span><span id="line-224"></span><span class="hs-comment">--</span><span>
</span><span id="line-225"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-226"></span><span class="hs-comment">-- [Trash Info]</span><span>
</span><span id="line-227"></span><span class="hs-comment">-- k1=v1</span><span>
</span><span id="line-228"></span><span class="hs-comment">-- k2=v2</span><span>
</span><span id="line-229"></span><span class="hs-comment">-- ...</span><span>
</span><span id="line-230"></span><span class="hs-comment">-- @</span><span>
</span><span id="line-231"></span><span class="hs-comment">--</span><span>
</span><span id="line-232"></span><span class="hs-comment">-- into a map of @{ ki =&gt; vi }@.</span><span>
</span><span id="line-233"></span><span class="hs-comment">--</span><span>
</span><span id="line-234"></span><span class="hs-comment">-- Verifies that the parameter key set is exactly the key set in the map.</span><span>
</span><span id="line-235"></span><span class="annot"><a href="Charon.Backend.Default.Utils.html#parseTrashInfoMap"><span class="hs-identifier hs-type">parseTrashInfoMap</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-236"></span><span>  </span><span class="annot"><span class="hs-comment">-- | Expected keys</span></span><span>
</span><span id="line-237"></span><span>  </span><span class="annot"><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashSet.Internal.html#HashSet"><span class="hs-identifier hs-type">HashSet</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-238"></span><span>  </span><span class="annot"><span class="hs-comment">-- | ByteString</span></span><span>
</span><span id="line-239"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-240"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span class="hs-special">)</span><span>
</span><span id="line-241"></span><span id="parseTrashInfoMap"><span class="annot"><span class="annottext">parseTrashInfoMap :: HashSet ByteString
-&gt; ByteString -&gt; Either String (HashMap ByteString ByteString)
</span><a href="Charon.Backend.Default.Utils.html#parseTrashInfoMap"><span class="hs-identifier hs-var hs-var">parseTrashInfoMap</span></a></span></span><span> </span><span id="local-6989586621679632447"><span class="annot"><span class="annottext">HashSet ByteString
</span><a href="#local-6989586621679632447"><span class="hs-identifier hs-var">expectedKeys</span></a></span></span><span> </span><span id="local-6989586621679632448"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679632448"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-242"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString]
</span><span class="hs-identifier hs-var">C8.lines</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679632448"><span class="hs-identifier hs-var">bs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-243"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String (HashMap ByteString ByteString)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Received empty pathdata&quot;</span></span><span>
</span><span id="line-244"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621679632450"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679632450"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679632451"><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679632451"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; Bool
</span><a href="#local-6989586621679632452"><span class="hs-identifier hs-var">isHeader</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679632450"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679632453"><span class="annot"><span class="annottext">mp :: HashMap ByteString ByteString
</span><a href="#local-6989586621679632453"><span class="hs-identifier hs-var hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ByteString, ByteString)] -&gt; HashMap ByteString ByteString
forall k v. (Eq k, Hashable k) =&gt; [(k, v)] -&gt; HashMap k v
</span><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashMap.Internal.Strict.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ByteString -&gt; (ByteString, ByteString))
-&gt; [ByteString] -&gt; [(ByteString, ByteString)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-identifier hs-var">fmap</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; (ByteString, ByteString)
</span><a href="Charon.Utils.html#breakEqBS"><span class="hs-identifier hs-var">U.breakEqBS</span></a></span><span> </span><span class="annot"><span class="annottext">[ByteString]
</span><a href="#local-6989586621679632451"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>          </span><span id="local-6989586621679632456"><span class="annot"><span class="annottext">keys :: HashSet ByteString
</span><a href="#local-6989586621679632456"><span class="hs-identifier hs-var hs-var">keys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashMap ByteString ByteString -&gt; HashSet ByteString
forall k a. HashMap k a -&gt; HashSet k
</span><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashSet.Internal.html#keysSet"><span class="hs-identifier hs-var">Map.keysSet</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap ByteString ByteString
</span><a href="#local-6989586621679632453"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-247"></span><span>          </span><span id="local-6989586621679632458"><span class="annot"><span class="annottext">missingKeys :: HashSet ByteString
</span><a href="#local-6989586621679632458"><span class="hs-identifier hs-var hs-var">missingKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet ByteString -&gt; HashSet ByteString -&gt; HashSet ByteString
forall a. (Eq a, Hashable a) =&gt; HashSet a -&gt; HashSet a -&gt; HashSet a
</span><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashSet.Internal.html#difference"><span class="hs-identifier hs-var">Set.difference</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ByteString
</span><a href="#local-6989586621679632447"><span class="hs-identifier hs-var">expectedKeys</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ByteString
</span><a href="#local-6989586621679632456"><span class="hs-identifier hs-var">keys</span></a></span><span>
</span><span id="line-248"></span><span>          </span><span id="local-6989586621679632460"><span class="annot"><span class="annottext">missingKeysStr :: ByteString
</span><a href="#local-6989586621679632460"><span class="hs-identifier hs-var hs-var">missingKeysStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">C8.intercalate</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashSet ByteString -&gt; [ByteString]
forall a. HashSet a -&gt; [a]
</span><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashSet.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ByteString
</span><a href="#local-6989586621679632458"><span class="hs-identifier hs-var">missingKeys</span></a></span><span>
</span><span id="line-249"></span><span>          </span><span id="local-6989586621679632463"><span class="annot"><span class="annottext">unexpectedKeys :: HashSet ByteString
</span><a href="#local-6989586621679632463"><span class="hs-identifier hs-var hs-var">unexpectedKeys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HashSet ByteString -&gt; HashSet ByteString -&gt; HashSet ByteString
forall a. (Eq a, Hashable a) =&gt; HashSet a -&gt; HashSet a -&gt; HashSet a
</span><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashSet.Internal.html#difference"><span class="hs-identifier hs-var">Set.difference</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ByteString
</span><a href="#local-6989586621679632456"><span class="hs-identifier hs-var">keys</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ByteString
</span><a href="#local-6989586621679632447"><span class="hs-identifier hs-var">expectedKeys</span></a></span><span>
</span><span id="line-250"></span><span>          </span><span id="local-6989586621679632464"><span class="annot"><span class="annottext">unexpectedKeysStr :: ByteString
</span><a href="#local-6989586621679632464"><span class="hs-identifier hs-var hs-var">unexpectedKeysStr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; [ByteString] -&gt; ByteString
</span><span class="hs-identifier hs-var">C8.intercalate</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">([ByteString] -&gt; ByteString) -&gt; [ByteString] -&gt; ByteString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">HashSet ByteString -&gt; [ByteString]
forall a. HashSet a -&gt; [a]
</span><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashSet.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ByteString
</span><a href="#local-6989586621679632463"><span class="hs-identifier hs-var">unexpectedKeys</span></a></span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Either String () -&gt; Either String ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet ByteString -&gt; Bool
forall a. HashSet a -&gt; Bool
</span><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashSet.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ByteString
</span><a href="#local-6989586621679632463"><span class="hs-identifier hs-var">unexpectedKeys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>        </span><span class="annot"><span class="annottext">(Either String () -&gt; Either String ())
-&gt; Either String () -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span>
</span><span id="line-254"></span><span>        </span><span class="annot"><span class="annottext">(String -&gt; Either String ()) -&gt; String -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Unexpected keys: '&quot;</span></span><span>
</span><span id="line-255"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><a href="Charon.Prelude.html#bsToStrLenient"><span class="hs-identifier hs-var">bsToStrLenient</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679632464"><span class="hs-identifier hs-var">unexpectedKeysStr</span></a></span><span>
</span><span id="line-256"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;'&quot;</span></span><span>
</span><span id="line-257"></span><span>
</span><span id="line-258"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Either String () -&gt; Either String ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><span class="hs-identifier hs-var">unless</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HashSet ByteString -&gt; Bool
forall a. HashSet a -&gt; Bool
</span><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashSet.Internal.html#null"><span class="hs-identifier hs-var">Set.null</span></a></span><span> </span><span class="annot"><span class="annottext">HashSet ByteString
</span><a href="#local-6989586621679632458"><span class="hs-identifier hs-var">missingKeys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>        </span><span class="annot"><span class="annottext">(Either String () -&gt; Either String ())
-&gt; Either String () -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String ()
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span>
</span><span id="line-260"></span><span>        </span><span class="annot"><span class="annottext">(String -&gt; Either String ()) -&gt; String -&gt; Either String ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Missing keys: '&quot;</span></span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><a href="Charon.Prelude.html#bsToStrLenient"><span class="hs-identifier hs-var">bsToStrLenient</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679632460"><span class="hs-identifier hs-var">missingKeysStr</span></a></span><span>
</span><span id="line-262"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;'&quot;</span></span><span>
</span><span id="line-263"></span><span>
</span><span id="line-264"></span><span>      </span><span class="annot"><span class="annottext">HashMap ByteString ByteString
-&gt; Either String (HashMap ByteString ByteString)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">HashMap ByteString ByteString
</span><a href="#local-6989586621679632453"><span class="hs-identifier hs-var">mp</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="annot"><span class="annottext">[ByteString]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String (HashMap ByteString ByteString)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String (HashMap ByteString ByteString))
-&gt; String -&gt; Either String (HashMap ByteString ByteString)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Did not receive header [Trash Info]: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><a href="Charon.Prelude.html#bsToStr"><span class="hs-identifier hs-var">bsToStr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679632448"><span class="hs-identifier hs-var">bs</span></a></span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621679632452"><span class="annot"><span class="annottext">isHeader :: ByteString -&gt; Bool
</span><a href="#local-6989586621679632452"><span class="hs-identifier hs-var hs-var">isHeader</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><span class="hs-string">&quot;[Trash Info]&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span id="local-6989586621679632014"><span class="annot"><a href="Charon.Backend.Default.Utils.html#lookup"><span class="hs-identifier hs-type">lookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashMap.Internal.html#HashMap"><span class="hs-identifier hs-type">HashMap</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">ByteString</span></span><span> </span><span class="annot"><a href="#local-6989586621679632014"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">String</span></span><span> </span><span class="annot"><a href="#local-6989586621679632014"><span class="hs-identifier hs-type">b</span></a></span></span><span>
</span><span id="line-270"></span><span id="lookup"><span class="annot"><span class="annottext">lookup :: forall b. ByteString -&gt; HashMap ByteString b -&gt; Either String b
</span><a href="Charon.Backend.Default.Utils.html#lookup"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621679632474"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679632474"><span class="hs-identifier hs-var">k</span></a></span></span><span> </span><span id="local-6989586621679632475"><span class="annot"><span class="annottext">HashMap ByteString b
</span><a href="#local-6989586621679632475"><span class="hs-identifier hs-var">mp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; HashMap ByteString b -&gt; Maybe b
forall k v. (Eq k, Hashable k) =&gt; k -&gt; HashMap k v -&gt; Maybe v
</span><a href="file:///nix/store/5lv6y93zqzymf4ryznc5wvz0s978f7px-unordered-containers-0.2.19.1-doc/share/doc/unordered-containers-0.2.19.1/html/src/Data.HashMap.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679632474"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">HashMap ByteString b
</span><a href="#local-6989586621679632475"><span class="hs-identifier hs-var">mp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-271"></span><span>  </span><span class="annot"><span class="annottext">Maybe b
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; Either String b
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Either String b) -&gt; String -&gt; Either String b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Could not find key: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><span class="hs-operator hs-var">&lt;&gt;</span></span><span> </span><span class="annot"><span class="annottext">ByteString -&gt; String
</span><a href="Charon.Prelude.html#bsToStr"><span class="hs-identifier hs-var">bsToStr</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621679632474"><span class="hs-identifier hs-var">k</span></a></span><span>
</span><span id="line-272"></span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679632477"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679632477"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; Either String b
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679632477"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-273"></span><span>
</span><span id="line-274"></span><span class="hs-comment">-- | Derives the 'PathType' from the 'PathData'.</span><span>
</span><span id="line-275"></span><span class="hs-comment">--</span><span>
</span><span id="line-276"></span><span class="hs-comment">-- __IMPORTANT:__ This function is only guaranteed to work if the 'PathData'</span><span>
</span><span id="line-277"></span><span class="hs-comment">-- corresponds to an extant trash entry. In particular, if the 'PathData' has</span><span>
</span><span id="line-278"></span><span class="hs-comment">-- not been created yet, this can fail.</span><span>
</span><span id="line-279"></span><span id="local-6989586621679632018"><span id="local-6989586621679632021"><span id="local-6989586621679632023"><span class="annot"><a href="Charon.Backend.Default.Utils.html#pathDataToType"><span class="hs-identifier hs-type">pathDataToType</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-280"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="file:///nix/store/4wakibz21ahaapk6h38p2l10j9a6z58i-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Internal.Optic.Subtyping.html#Is"><span class="hs-identifier hs-type">Is</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679632018"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="file:///nix/store/4wakibz21ahaapk6h38p2l10j9a6z58i-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Internal.Optic.Types.html#A_Getter"><span class="hs-identifier hs-type">A_Getter</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>    </span><span class="annot"><a href="file:///nix/store/4wakibz21ahaapk6h38p2l10j9a6z58i-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Label.html#LabelOptic%27"><span class="hs-identifier hs-type">LabelOptic'</span></a></span><span> </span><span class="annot"><span class="hs-string">&quot;fileName&quot;</span></span><span> </span><span class="annot"><a href="#local-6989586621679632018"><span class="hs-identifier hs-type">k</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679632021"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashEntryFileName"><span class="hs-identifier hs-type">TrashEntryFileName</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">HasCallStack</span></span><span class="hs-special">,</span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><span class="hs-identifier hs-type">MonadCatch</span></span><span> </span><span class="annot"><a href="#local-6989586621679632023"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#MonadPathReader"><span class="hs-identifier hs-type">MonadPathReader</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679632023"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-285"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-286"></span><span>  </span><span class="annot"><a href="Charon.Data.Paths.html#PathI"><span class="hs-identifier hs-type">PathI</span></a></span><span> </span><span class="annot"><a href="Charon.Data.Paths.html#TrashHome"><span class="hs-identifier hs-type">TrashHome</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-287"></span><span>  </span><span class="annot"><a href="#local-6989586621679632021"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-288"></span><span>  </span><span class="annot"><a href="#local-6989586621679632023"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Charon.Data.PathType.html#PathTypeW"><span class="hs-identifier hs-type">PathTypeW</span></a></span></span></span></span><span>
</span><span id="line-289"></span><span id="pathDataToType"><span class="annot"><span class="annottext">pathDataToType :: forall k a (m :: * -&gt; *).
(Is k A_Getter,
 LabelOptic' &quot;fileName&quot; k a (PathI 'TrashEntryFileName),
 HasCallStack, MonadCatch m, MonadPathReader m) =&gt;
PathI 'TrashHome -&gt; a -&gt; m PathTypeW
</span><a href="Charon.Backend.Default.Utils.html#pathDataToType"><span class="hs-identifier hs-var hs-var">pathDataToType</span></a></span></span><span> </span><span id="local-6989586621679632496"><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632496"><span class="hs-identifier hs-var">trashHome</span></a></span></span><span> </span><span id="local-6989586621679632497"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679632497"><span class="hs-identifier hs-var">pd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PathType -&gt; PathTypeW
</span><a href="Charon.Data.PathType.html#MkPathTypeW"><span class="hs-identifier hs-var">MkPathTypeW</span></a></span><span> </span><span class="annot"><span class="annottext">(PathType -&gt; PathTypeW) -&gt; m PathType -&gt; m PathTypeW
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">OsPath -&gt; m PathType
forall (m :: * -&gt; *).
(HasCallStack, MonadCatch m, MonadPathReader m) =&gt;
OsPath -&gt; m PathType
</span><a href="file:///home/tommy/.local/state/cabal/store/ghc-9.6.3/effects-fs-0.1-3501a17f5ae0a156664422d80cce2bdc213ea1c83812f6e0233089e60892c3b9/share/doc/html/src/Effects.FileSystem.PathReader.html#getPathType"><span class="hs-identifier hs-var">PR.getPathType</span></a></span><span> </span><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679632498"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-291"></span><span>    </span><span class="hs-comment">-- see NOTE: [getPathType]</span><span>
</span><span id="line-292"></span><span>    </span><span class="annot"><a href="Charon.Data.Paths.html#MkPathI"><span class="hs-identifier hs-type">MkPathI</span></a></span><span> </span><span id="local-6989586621679632498"><span class="annot"><span class="annottext">OsPath
</span><a href="#local-6989586621679632498"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome
-&gt; PathI 'TrashEntryFileName -&gt; PathI 'TrashEntryPath
</span><a href="Charon.Backend.Default.Utils.html#getTrashPath"><span class="hs-identifier hs-var">getTrashPath</span></a></span><span> </span><span class="annot"><span class="annottext">PathI 'TrashHome
</span><a href="#local-6989586621679632496"><span class="hs-identifier hs-var">trashHome</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679632497"><span class="hs-identifier hs-var">pd</span></a></span><span> </span><span class="annot"><span class="annottext">a
-&gt; Optic' k NoIx a (PathI 'TrashEntryFileName)
-&gt; PathI 'TrashEntryFileName
forall k s (is :: IxList) a.
Is k A_Getter =&gt;
s -&gt; Optic' k is s a -&gt; a
</span><a href="file:///nix/store/4wakibz21ahaapk6h38p2l10j9a6z58i-optics-core-0.4.1.1-doc/share/doc/optics-core-0.4.1.1/html/src/Optics.Operators.html#%5E."><span class="hs-operator hs-var">^.</span></a></span><span> </span><span class="annot"><span class="annottext">Optic' k NoIx a (PathI 'TrashEntryFileName)
</span><span class="">#fileName</span></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>
</span><span id="line-294"></span><span class="annot"><a href="Charon.Backend.Default.Utils.html#pathFiles"><span class="hs-identifier hs-type">pathFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span>
</span><span id="line-295"></span><span id="pathFiles"><span class="annot"><span class="annottext">pathFiles :: OsPath
</span><a href="Charon.Backend.Default.Utils.html#pathFiles"><span class="hs-identifier hs-var hs-var">pathFiles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[osp|files|]</span></span><span>
</span><span id="line-296"></span><span>
</span><span id="line-297"></span><span class="annot"><a href="Charon.Backend.Default.Utils.html#pathInfo"><span class="hs-identifier hs-type">pathInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">OsPath</span></span><span>
</span><span id="line-298"></span><span id="pathInfo"><span class="annot"><span class="annottext">pathInfo :: OsPath
</span><a href="Charon.Backend.Default.Utils.html#pathInfo"><span class="hs-identifier hs-var hs-var">pathInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="">[osp|info|]</span></span><span>
</span><span id="line-299"></span></pre></body></html>